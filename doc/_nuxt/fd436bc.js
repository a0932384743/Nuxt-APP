/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{815:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(811),o=n(812),l=n(813),c=n(814);class h{constructor(e,t){this._delegate=e,this.firebase=t,Object(l._addComponent)(e,new o.a("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),Object(l.deleteApp)(this._delegate))))}_getService(e,t=l._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=l._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(component){Object(l._addComponent)(this._delegate,component)}_addOrOverwriteComponent(component){Object(l._addOrOverwriteComponent)(this._delegate,component)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const d={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},_=new r.b("app-compat","Firebase",d);const f=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(o,c={}){const h=l.initializeApp(o,c);if(Object(r.k)(t,h.name))return t[h.name];const d=new e(h,n);return t[h.name]=d,d},app:o,registerVersion:l.registerVersion,setLogLevel:l.setLogLevel,onLog:l.onLog,apps:null,SDK_VERSION:l.SDK_VERSION,INTERNAL:{registerComponent:function(component){const t=component.name,c=t.replace("-compat","");if(l._registerComponent(component)&&"PUBLIC"===component.type){const l=(e=o())=>{if("function"!=typeof e[c])throw _.create("invalid-app-argument",{appName:t});return e[c]()};void 0!==component.serviceProps&&Object(r.p)(l,component.serviceProps),n[c]=l,e.prototype[c]=function(...e){return this._getService.bind(this,t).apply(this,component.multipleInstances?e:[])}}return"PUBLIC"===component.type?n[c]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){if("serverAuth"===t)return null;return t},modularAPIs:l}};function o(e){if(e=e||l._DEFAULT_ENTRY_NAME,!Object(r.k)(t,e))throw _.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),o.App=e,n}(h);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){Object(r.p)(t,e)},createSubscribe:r.m,ErrorFactory:r.b,deepExtend:r.p}),t}(),m=new c.b("@firebase/app-compat");if(Object(r.z)()&&void 0!==self.firebase){m.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&m.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const y=f;var v;Object(l.registerVersion)("@firebase/app-compat","0.2.13",v)},840:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Gr})),n.d(t,"b",(function(){return $r})),n.d(t,"c",(function(){return Pt})),n.d(t,"d",(function(){return es})),n.d(t,"e",(function(){return Ks})),n.d(t,"f",(function(){return f})),n.d(t,"g",(function(){return rr})),n.d(t,"h",(function(){return or})),n.d(t,"i",(function(){return rs})),n.d(t,"j",(function(){return Zs})),n.d(t,"k",(function(){return no})),n.d(t,"l",(function(){return Ts})),n.d(t,"m",(function(){return Ss})),n.d(t,"n",(function(){return Vs})),n.d(t,"o",(function(){return Xs})),n.d(t,"p",(function(){return Js})),n.d(t,"q",(function(){return us})),n.d(t,"r",(function(){return eo})),n.d(t,"s",(function(){return to})),n.d(t,"t",(function(){return so})),n.d(t,"u",(function(){return xs})),n.d(t,"v",(function(){return Rs})),n.d(t,"w",(function(){return bs})),n.d(t,"x",(function(){return gs})),n.d(t,"y",(function(){return ms})),n.d(t,"z",(function(){return ys})),n.d(t,"A",(function(){return vs})),n.d(t,"B",(function(){return fs})),n.d(t,"C",(function(){return As})),n.d(t,"D",(function(){return Fs})),n.d(t,"E",(function(){return Ms})),n.d(t,"F",(function(){return Us})),n.d(t,"G",(function(){return ss})),n.d(t,"H",(function(){return Hs})),n.d(t,"I",(function(){return ns})),n.d(t,"J",(function(){return is})),n.d(t,"K",(function(){return os})),n.d(t,"L",(function(){return ao})),n.d(t,"M",(function(){return ro})),n.d(t,"N",(function(){return as})),n.d(t,"O",(function(){return ls})),n.d(t,"P",(function(){return cs})),n.d(t,"Q",(function(){return Ps})),n.d(t,"R",(function(){return ks})),n.d(t,"S",(function(){return hs}));var r=n(813),o=n(812),l=n(811),c=n(814);const h="@firebase/database",d="0.14.4";let _="";function f(e){_=e}class m{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(l.R)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(l.K)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class y{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Object(l.k)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const v=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new m(t)}}catch(e){}return new y},w=v("localStorage"),C=v("sessionStorage"),T=new c.b("@firebase/database"),O=function(){let e=1;return function(){return e++}}(),S=function(e){const t=Object(l.Q)(e),n=new l.d;n.update(t);const r=n.digest();return l.g.encodeByteArray(r)},I=function(...e){let t="";for(let i=0;i<e.length;i++){const n=e[i];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=I.apply(null,n):t+="object"==typeof n?Object(l.R)(n):n,t+=" "}return t};let k=null,E=!0;const P=function(e,t){Object(l.e)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(T.logLevel=c.a.VERBOSE,k=T.log.bind(T),t&&C.set("logging_enabled",!0)):"function"==typeof e?k=e:(k=null,C.remove("logging_enabled"))},N=function(...e){if(!0===E&&(E=!1,null===k&&!0===C.get("logging_enabled")&&P(!0)),k){const t=I.apply(null,e);k(t)}},x=function(e){return function(...t){N(e,...t)}},j=function(...e){const t="FIREBASE INTERNAL ERROR: "+I(...e);T.error(t)},R=function(...e){const t=`FIREBASE FATAL ERROR: ${I(...e)}`;throw T.error(t),new Error(t)},D=function(...e){const t="FIREBASE WARNING: "+I(...e);T.warn(t)},A=function(data){return"number"==typeof data&&(data!=data||data===Number.POSITIVE_INFINITY||data===Number.NEGATIVE_INFINITY)},F="[MIN_NAME]",L="[MAX_NAME]",M=function(a,b){if(a===b)return 0;if(a===F||b===L)return-1;if(b===F||a===L)return 1;{const e=Y(a),t=Y(b);return null!==e?null!==t?e-t==0?a.length-b.length:e-t:-1:null!==t?1:a<b?-1:1}},W=function(a,b){return a===b?0:a<b?-1:1},U=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(l.R)(t))},B=function(e){if("object"!=typeof e||null===e)return Object(l.R)(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=Object(l.R)(t[i]),n+=":",n+=B(e[t[i]]);return n+="}",n},V=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let o=0;o<n;o+=t)o+t>n?r.push(e.substring(o,n)):r.push(e.substring(o,o+t));return r};function H(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const Q=function(e){Object(l.e)(!A(e),"Invalid JSON number");const t=1023;let s,n,r,o,i;0===e?(n=0,r=0,s=1/e==-1/0?1:0):(s=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),n=o+t,r=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));const c=[];for(i=52;i;i-=1)c.push(r%2?1:0),r=Math.floor(r/2);for(i=11;i;i-=1)c.push(n%2?1:0),n=Math.floor(n/2);c.push(s?1:0),c.reverse();const h=c.join("");let d="";for(i=0;i<64;i+=8){let e=parseInt(h.substr(i,8),2).toString(16);1===e.length&&(e="0"+e),d+=e}return d.toLowerCase()};const z=new RegExp("^-?(0*)\\d{1,10}$"),Y=function(e){if(z.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},K=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw D("Exception was thrown by user callback.",t),e}),Math.floor(0))}},G=function(e,time){const t=setTimeout(e,time);return"number"==typeof t&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class ${constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){D(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class J{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(N("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',D(e)}}class X{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}X.OWNER="owner";const Z="5",ee=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,te="ac",ne="websocket",ie="long_polling";class re{constructor(e,t,n,r,o=!1,l="",c=!1,h=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=o,this.persistenceKey=l,this.includeNamespaceInQueryParams=c,this.isUsingEmulator=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=w.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&w.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function se(e,t,n){let r;if(Object(l.e)("string"==typeof t,"typeof type must == string"),Object(l.e)("object"==typeof n,"typeof params must == object"),t===ne)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==ie)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const o=[];return H(n,((e,t)=>{o.push(e+"="+t)})),r+o.join("&")}class oe{constructor(){this.counters_={}}incrementCounter(e,t=1){Object(l.k)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Object(l.n)(this.counters_)}}const ae={},le={};function ce(e){const t=e.toString();return ae[t]||(ae[t]=new oe),ae[t]}class he{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,data){for(this.pendingResponses[e]=data;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<e.length;++i)e[i]&&K((()=>{this.onMessage_(e[i])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const ue="start";class de{constructor(e,t,n,r,o,l,c){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.transportSessionId=l,this.lastSessionId=c,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=x(e),this.stats_=ce(t),this.urlFn=e=>(this.appCheckToken&&(e[te]=this.appCheckToken),se(t,ie,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new he(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Object(l.G)()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new _e(((...e)=>{const[t,n,r,o,l]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===ue)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,data]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,data)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[ue]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=Z,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[te]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&ee.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){de.forceAllow_=!0}static forceDisallow(){de.forceDisallow_=!0}static isAvailable(){return!Object(l.G)()&&(!!de.forceAllow_||!(de.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(data){const e=Object(l.R)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const t=Object(l.i)(e),n=V(t,1840);for(let i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Object(l.G)())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Object(l.R)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class _e{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(l.G)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=O(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=_e.createIFrame_();let script="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){script='<script>document.domain="'+document.domain+'";<\/script>'}const n="<html><body>"+script+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(e){N("frame writing exception"),e.stack&&N(e.stack),N(e)}}}static createIFrame_(){const iframe=document.createElement("iframe");if(iframe.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(iframe);try{iframe.contentWindow.document||N("No IE domain setting required")}catch(e){const t=document.domain;iframe.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return iframe.contentDocument?iframe.doc=iframe.contentDocument:iframe.contentWindow?iframe.doc=iframe.contentWindow.document:iframe.document&&(iframe.doc=iframe.document),iframe}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,data){this.pendingSegs.push({seg:e,ts:t,d:data}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(r),n()}))}addTag(e,t){Object(l.G)()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{N("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let pe=null;"undefined"!=typeof MozWebSocket?pe=MozWebSocket:"undefined"!=typeof WebSocket&&(pe=WebSocket);class fe{constructor(e,t,n,r,o,l,c){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=x(this.connId),this.stats_=ce(t),this.connURL=fe.connectionURL_(t,l,c,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,o){const c={};return c.v=Z,!Object(l.G)()&&"undefined"!=typeof location&&location.hostname&&ee.test(location.hostname)&&(c.r="f"),t&&(c.s=t),n&&(c.ls=n),r&&(c[te]=r),o&&(c.p=o),se(e,ne,c)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,w.set("previous_websocket_failure",!0);try{let t;if(Object(l.G)()){const n=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":`Firebase/${Z}/${_}/${e.platform}/${n}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const r=e.env,o=0===this.connURL.indexOf("wss://")?r.HTTPS_PROXY||r.https_proxy:r.HTTP_PROXY||r.http_proxy;o&&(t.proxy={origin:o})}this.mySock=new pe(this.connURL,[],t)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){fe.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==pe&&!fe.forceDisallow_}static previouslyFailed(){return w.isInMemoryStorage||!0===w.get("previous_websocket_failure")}markConnectionHealthy(){w.remove("previous_websocket_failure")}appendFrame_(data){if(this.frames.push(data),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Object(l.K)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(data){if(Object(l.e)(null===this.frames,"We already have a frame buffer"),data.length<=6){const e=Number(data);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),data}handleIncomingFrame(e){if(null===this.mySock)return;const data=e.data;if(this.bytesReceived+=data.length,this.stats_.incrementCounter("bytes_received",data.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(data);else{const e=this.extractFrameCount_(data);null!==e&&this.appendFrame_(e)}}send(data){this.resetKeepAlive();const e=Object(l.R)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const t=V(e,16384);t.length>1&&this.sendString_(String(t.length));for(let i=0;i<t.length;i++)this.sendString_(t[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}fe.responsesRequiredToBeHealthy=2,fe.healthyTimeout=3e4;class ge{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[de,fe]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=fe&&fe.isAvailable();let n=t&&!fe.previouslyFailed();if(e.webSocketOnly&&(t||D("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[fe];else{const e=this.transports_=[];for(const t of ge.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);ge.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ge.globalTransportInitialized_=!1;class me{constructor(e,t,n,r,o,l,c,h,d,_){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=o,this.onMessage_=l,this.onReady_=c,this.onDisconnect_=h,this.onKill_=d,this.lastSessionId=_,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=x("c:"+this.id+":"),this.transportManager_=new ge(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=G((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=U("t",e),data=U("d",e);if("c"===t)this.onSecondaryControl_(data);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(data)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=U("t",e),data=U("d",e);"c"===t?this.onControl_(data):"d"===t&&this.onDataMessage_(data)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=U("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?j("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):j("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Z!==n&&D("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),G((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):G((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(w.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(data){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(data)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ye{put(e,data,t,n){}merge(e,data,t,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,data,t){}onDisconnectMerge(e,data,t){}onDisconnectCancel(e,t){}reportStats(e){}}class ve{constructor(e){this.allowedEvents_=e,this.listeners_={},Object(l.e)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let i=0;i<n.length;i++)n[i].callback.apply(n[i].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){Object(l.e)(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class be extends ve{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(l.E)()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new be}getInitialEvent(e){return Object(l.e)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const we=32,Ce=768;class Te{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[t]=this.pieces_[i],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let i=this.pieceNum_;i<this.pieces_.length;i++)""!==this.pieces_[i]&&(e+="/"+this.pieces_[i]);return e||"/"}}function Oe(){return new Te("")}function Se(path){return path.pieceNum_>=path.pieces_.length?null:path.pieces_[path.pieceNum_]}function Ie(path){return path.pieces_.length-path.pieceNum_}function ke(path){let e=path.pieceNum_;return e<path.pieces_.length&&e++,new Te(path.pieces_,e)}function Ee(path){return path.pieceNum_<path.pieces_.length?path.pieces_[path.pieces_.length-1]:null}function Pe(path,e=0){return path.pieces_.slice(path.pieceNum_+e)}function Ne(path){if(path.pieceNum_>=path.pieces_.length)return null;const e=[];for(let i=path.pieceNum_;i<path.pieces_.length-1;i++)e.push(path.pieces_[i]);return new Te(e,0)}function xe(path,e){const t=[];for(let i=path.pieceNum_;i<path.pieces_.length;i++)t.push(path.pieces_[i]);if(e instanceof Te)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const n=e.split("/");for(let i=0;i<n.length;i++)n[i].length>0&&t.push(n[i])}return new Te(t,0)}function je(path){return path.pieceNum_>=path.pieces_.length}function Re(e,t){const n=Se(e),r=Se(t);if(null===n)return t;if(n===r)return Re(ke(e),ke(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function De(e,t){const n=Pe(e,0),r=Pe(t,0);for(let i=0;i<n.length&&i<r.length;i++){const e=M(n[i],r[i]);if(0!==e)return e}return n.length===r.length?0:n.length<r.length?-1:1}function Ae(path,e){if(Ie(path)!==Ie(e))return!1;for(let i=path.pieceNum_,t=e.pieceNum_;i<=path.pieces_.length;i++,t++)if(path.pieces_[i]!==e.pieces_[t])return!1;return!0}function qe(path,e){let i=path.pieceNum_,t=e.pieceNum_;if(Ie(path)>Ie(e))return!1;for(;i<path.pieces_.length;){if(path.pieces_[i]!==e.pieces_[t])return!1;++i,++t}return!0}class Fe{constructor(path,e){this.errorPrefix_=e,this.parts_=Pe(path,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Object(l.P)(this.parts_[i]);Le(this)}}function Le(e){if(e.byteLength_>Ce)throw new Error(e.errorPrefix_+"has a key path longer than "+Ce+" bytes ("+e.byteLength_+").");if(e.parts_.length>we)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+we+") or object contains a cycle "+Me(e))}function Me(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class We extends ve{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new We}getInitialEvent(e){return Object(l.e)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Ue=1e3;class Be extends ye{constructor(e,t,n,r,o,c,h,d){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=c,this.appCheckTokenProvider_=h,this.authOverride_=d,this.id=Be.nextPersistentConnectionId_++,this.log_=x("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ue,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,d&&!Object(l.G)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");We.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&be.getInstance().on("online",this.onOnline_,this)}sendRequest(e,body,t){const n=++this.requestNumber_,r={r:n,a:e,b:body};this.log_(Object(l.R)(r)),Object(l.e)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),t&&(this.requestCBHash_[n]=t)}get(e){this.initConnection_();const t=new l.a,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();const o=e._queryIdentifier,c=e._path.toString();this.log_("Listen called for "+c+" "+o),this.listens.has(c)||this.listens.set(c,new Map),Object(l.e)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Object(l.e)(!this.listens.get(c).has(o),"listen() called twice for same path/queryId.");const h={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(c).set(o,h),this.connected_&&this.sendListen_(h)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const o={p:n};e.tag&&(o.q=t._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,(o=>{const l=o.d,c=o.s;Be.warnOnListenWarnings_(l,t);(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",o),"ok"!==c&&this.removeListen_(n,r),e.onComplete&&e.onComplete(c,l))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Object(l.k)(e,"w")){const n=Object(l.O)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();D(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||Object(l.y)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Object(l.J)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,data=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,data))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,data=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,data)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Object(l.e)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const o={p:e};r&&(o.q=n,o.t=r),this.sendRequest("n",o)}onDisconnectPut(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:data,onComplete:t})}onDisconnectMerge(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:data,onComplete:t})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,data,n){const r={p:t,d:data};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{n&&setTimeout((()=>{n(e.s,e.d)}),Math.floor(0))}))}put(e,data,t,n){this.putInternal("p",e,data,t,n)}merge(e,data,t,n){this.putInternal("m",e,data,t,n)}putInternal(e,t,data,n,r){this.initConnection_();const o={p:t,d:data};void 0!==r&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:n}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Object(l.R)(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,body){this.log_("handleServerMessage",e,body),"d"===e?this.onDataUpdate_(body.p,body.d,!1,body.t):"m"===e?this.onDataUpdate_(body.p,body.d,!0,body.t):"c"===e?this.onListenRevoked_(body.p,body.q):"ac"===e?this.onAuthRevoked_(body.s,body.d):"apc"===e?this.onAppCheckRevoked_(body.s,body.d):"sd"===e?this.onSecurityDebugPacket_(body):j("Unrecognized action received from server: "+Object(l.R)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Object(l.e)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ue,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ue,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Ue),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Be.nextConnectionId_++,o=this.lastSessionId;let c=!1,h=null;const d=function(){h?h.close():(c=!0,n())},_=function(e){Object(l.e)(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(e)};this.realtime_={close:d,sendRequest:_};const f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[l,d]=await Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);c?N("getToken() completed but was canceled"):(N("getToken() completed. Creating connection."),this.authToken_=l&&l.accessToken,this.appCheckToken_=d&&d.token,h=new me(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{D(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),o))}catch(e){this.log_("Failed to get token: "+e),c||(this.repoInfo_.nodeAdmin&&D(e),d())}}}interrupt(e){N("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){N("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(l.B)(this.interruptReasons_)&&(this.reconnectDelay_=Ue,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let i=0;i<this.outstandingPuts_.length;i++){const e=this.outstandingPuts_[i];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[i],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((q=>B(q))).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new Te(e).toString();let r;if(this.listens.has(n)){const map=this.listens.get(n);r=map.get(t),map.delete(t),0===map.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){N("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){N("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(body){this.securityDebugCallback_?this.securityDebugCallback_(body):"msg"in body&&console.log("FIREBASE: "+body.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let i=0;i<this.outstandingPuts_.length;i++)this.outstandingPuts_[i]&&this.sendPut_(i);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const e={};let t="js";Object(l.G)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+_.replace(/\./g,"-")]=1,Object(l.E)()?e["framework.cordova"]=1:Object(l.H)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=be.getInstance().currentlyOnline();return Object(l.B)(this.interruptReasons_)&&e}}Be.nextPersistentConnectionId_=0,Be.nextConnectionId_=0;class Ve{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ve(e,t)}}class He{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Ve(F,e),r=new Ve(F,t);return 0!==this.compare(n,r)}minPost(){return Ve.MIN}}let Qe;class ze extends He{static get __EMPTY_NODE(){return Qe}static set __EMPTY_NODE(e){Qe=e}compare(a,b){return M(a.name,b.name)}isDefinedOn(e){throw Object(l.f)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ve.MIN}maxPost(){return new Ve(L,Qe)}makePost(e,t){return Object(l.e)("string"==typeof e,"KeyIndex indexValue must always be a string."),new Ve(e,Qe)}toString(){return".key"}}const Ye=new ze;class Ke{constructor(e,t,n,r,o=null){this.isReverse_=r,this.resultGenerator_=o,this.nodeStack_=[];let l=1;for(;!e.isEmpty();)if(l=t?n(e.key,t):1,r&&(l*=-1),l<0)e=this.isReverse_?e.left:e.right;else{if(0===l){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ge{constructor(e,t,n,r,o){this.key=e,this.value=t,this.color=null!=n?n:Ge.RED,this.left=null!=r?r:$e.EMPTY_NODE,this.right=null!=o?o:$e.EMPTY_NODE}copy(e,t,n,r,o){return new Ge(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=o?o:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const o=n(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===o?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return $e.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return $e.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Ge.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Ge.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ge.RED=!0,Ge.BLACK=!1;class $e{constructor(e,t=$e.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new $e(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ge.BLACK,null,null))}remove(e){return new $e(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ge.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ke(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ke(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ke(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ke(this.root_,null,this.comparator_,!0,e)}}function Je(e,t){return M(e.name,t.name)}function Xe(e,t){return M(e,t)}let Ze;$e.EMPTY_NODE=new class{copy(e,t,n,r,o){return this}insert(e,t,n){return new Ge(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const et=function(e){return"number"==typeof e?"number:"+Q(e):"string:"+e},tt=function(e){if(e.isLeafNode()){const t=e.val();Object(l.e)("string"==typeof t||"number"==typeof t||"object"==typeof t&&Object(l.k)(t,".sv"),"Priority must be a string or number.")}else Object(l.e)(e===Ze||e.isEmpty(),"priority of unexpected type.");Object(l.e)(e===Ze||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let nt,it,st;class ot{constructor(e,t=ot.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Object(l.e)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),tt(this.priorityNode_)}static set __childrenNodeConstructor(e){nt=e}static get __childrenNodeConstructor(){return nt}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ot(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:ot.__childrenNodeConstructor.EMPTY_NODE}getChild(path){return je(path)?this:".priority"===Se(path)?this.priorityNode_:ot.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:ot.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(path,e){const t=Se(path);return null===t?e:e.isEmpty()&&".priority"!==t?this:(Object(l.e)(".priority"!==t||1===Ie(path),".priority must be the last token in a path"),this.updateImmediateChild(t,ot.__childrenNodeConstructor.EMPTY_NODE.updateChild(ke(path),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+et(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?Q(this.value_):this.value_,this.lazyHash_=S(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ot.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ot.__childrenNodeConstructor?-1:(Object(l.e)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=ot.VALUE_TYPE_ORDER.indexOf(t),o=ot.VALUE_TYPE_ORDER.indexOf(n);return Object(l.e)(r>=0,"Unknown leaf type: "+t),Object(l.e)(o>=0,"Unknown leaf type: "+n),r===o?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}ot.VALUE_TYPE_ORDER=["object","boolean","number","string"];const at=new class extends He{compare(a,b){const e=a.node.getPriority(),t=b.node.getPriority(),n=e.compareTo(t);return 0===n?M(a.name,b.name):n}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ve.MIN}maxPost(){return new Ve(L,new ot("[PRIORITY-POST]",st))}makePost(e,t){const n=it(e);return new Ve(t,new ot("[PRIORITY-POST]",n))}toString(){return".priority"}},lt=Math.log(2);class ct{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/lt,10)),this.current_=this.count-1;const mask=(n=this.count,parseInt(Array(n+1).join("1"),2));var n;this.bits_=e+1&mask}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const ht=function(e,t,n,r){e.sort(t);const o=function(t,r){const l=r-t;let c,h;if(0===l)return null;if(1===l)return c=e[t],h=n?n(c):c,new Ge(h,c.node,Ge.BLACK,null,null);{const d=parseInt(l/2,10)+t,_=o(t,d),f=o(d+1,r);return c=e[d],h=n?n(c):c,new Ge(h,c.node,Ge.BLACK,_,f)}},l=function(t){let r=null,l=null,c=e.length;const h=function(t,r){const l=c-t,h=c;c-=t;const _=o(l+1,h),f=e[l],m=n?n(f):f;d(new Ge(m,f.node,r,null,_))},d=function(e){r?(r.left=e,r=e):(l=e,r=e)};for(let i=0;i<t.count;++i){const e=t.nextBitIsOne(),n=Math.pow(2,t.count-(i+1));e?h(n,Ge.BLACK):(h(n,Ge.BLACK),h(n,Ge.RED))}return l}(new ct(e.length));return new $e(r||t,l)};let ut;const _t={};class pt{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Object(l.e)(_t&&at,"ChildrenNode.ts has not been loaded"),ut=ut||new pt({".priority":_t},{".priority":at}),ut}get(e){const t=Object(l.O)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof $e?t:null}hasIndex(e){return Object(l.k)(this.indexSet_,e.toString())}addIndex(e,t){Object(l.e)(e!==Ye,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const o=t.getIterator(Ve.Wrap);let c,h=o.getNext();for(;h;)r=r||e.isDefinedOn(h.node),n.push(h),h=o.getNext();c=r?ht(n,e.getCompare()):_t;const d=e.toString(),_=Object.assign({},this.indexSet_);_[d]=e;const f=Object.assign({},this.indexes_);return f[d]=c,new pt(f,_)}addToIndexes(e,t){const n=Object(l.L)(this.indexes_,((n,r)=>{const o=Object(l.O)(this.indexSet_,r);if(Object(l.e)(o,"Missing index implementation for "+r),n===_t){if(o.isDefinedOn(e.node)){const n=[],r=t.getIterator(Ve.Wrap);let l=r.getNext();for(;l;)l.name!==e.name&&n.push(l),l=r.getNext();return n.push(e),ht(n,o.getCompare())}return _t}{const r=t.get(e.name);let o=n;return r&&(o=o.remove(new Ve(e.name,r))),o.insert(e,e.node)}}));return new pt(n,this.indexSet_)}removeFromIndexes(e,t){const n=Object(l.L)(this.indexes_,(n=>{if(n===_t)return n;{const r=t.get(e.name);return r?n.remove(new Ve(e.name,r)):n}}));return new pt(n,this.indexSet_)}}let ft;class gt{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&tt(this.priorityNode_),this.children_.isEmpty()&&Object(l.e)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ft||(ft=new gt(new $e(Xe),null,pt.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ft}updatePriority(e){return this.children_.isEmpty()?this:new gt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?ft:t}}getChild(path){const e=Se(path);return null===e?this:this.getImmediateChild(e).getChild(ke(path))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(Object(l.e)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Ve(e,t);let r,o;t.isEmpty()?(r=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),o=this.indexMap_.addToIndexes(n,this.children_));const l=r.isEmpty()?ft:this.priorityNode_;return new gt(r,l,o)}}updateChild(path,e){const t=Se(path);if(null===t)return e;{Object(l.e)(".priority"!==Se(path)||1===Ie(path),".priority must be the last token in a path");const n=this.getImmediateChild(t).updateChild(ke(path),e);return this.updateImmediateChild(t,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,o=!0;if(this.forEachChild(at,((l,c)=>{t[l]=c.val(e),n++,o&&gt.INTEGER_REGEXP_.test(l)?r=Math.max(r,Number(l)):o=!1})),!e&&o&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+et(this.getPriority().val())+":"),this.forEachChild(at,((t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":S(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new Ve(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Ve(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Ve(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,Ve.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,Ve.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===mt?-1:0}withIndex(e){if(e===Ye||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new gt(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Ye||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(at),n=t.getIterator(at);let r=e.getNext(),o=n.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=e.getNext(),o=n.getNext()}return null===r&&null===o}return!1}return!1}}resolveIndex_(e){return e===Ye?null:this.indexMap_.get(e.toString())}}gt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const mt=new class extends gt{constructor(){super(new $e(Xe),gt.EMPTY_NODE,pt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return gt.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Ve,{MIN:{value:new Ve(F,gt.EMPTY_NODE)},MAX:{value:new Ve(L,mt)}}),ze.__EMPTY_NODE=gt.EMPTY_NODE,ot.__childrenNodeConstructor=gt,Ze=mt,function(e){st=e}(mt);const yt=!0;function vt(e,t=null){if(null===e)return gt.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Object(l.e)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new ot(e,vt(t))}if(e instanceof Array||!yt){let n=gt.EMPTY_NODE;return H(e,((t,r)=>{if(Object(l.k)(e,t)&&"."!==t.substring(0,1)){const e=vt(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(vt(t))}{const n=[];let r=!1;if(H(e,((e,t)=>{if("."!==e.substring(0,1)){const o=vt(t);o.isEmpty()||(r=r||!o.getPriority().isEmpty(),n.push(new Ve(e,o)))}})),0===n.length)return gt.EMPTY_NODE;const o=ht(n,Je,(e=>e.name),Xe);if(r){const e=ht(n,at.getCompare());return new gt(o,vt(t),new pt({".priority":e},{".priority":at}))}return new gt(o,vt(t),pt.Default)}}!function(e){it=e}(vt);class bt extends He{constructor(e){super(),this.indexPath_=e,Object(l.e)(!je(e)&&".priority"!==Se(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(a,b){const e=this.extractChild(a.node),t=this.extractChild(b.node),n=e.compareTo(t);return 0===n?M(a.name,b.name):n}makePost(e,t){const n=vt(e),r=gt.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ve(t,r)}maxPost(){const e=gt.EMPTY_NODE.updateChild(this.indexPath_,mt);return new Ve(L,e)}toString(){return Pe(this.indexPath_,0).join("/")}}const wt=new class extends He{compare(a,b){const e=a.node.compareTo(b.node);return 0===e?M(a.name,b.name):e}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ve.MIN}maxPost(){return Ve.MAX}makePost(e,t){const n=vt(e);return new Ve(t,n)}toString(){return".value"}};function Ct(e){return{type:"value",snapshotNode:e}}function Tt(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Ot(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function St(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class It{constructor(e){this.index_=e}updateChild(e,t,n,r,source,o){Object(l.e)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const c=e.getImmediateChild(t);return c.getChild(r).equals(n.getChild(r))&&c.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Ot(t,c)):Object(l.e)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):c.isEmpty()?o.trackChildChange(Tt(t,n)):o.trackChildChange(St(t,n,c))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(at,((e,r)=>{t.hasChild(e)||n.trackChildChange(Ot(e,r))})),t.isLeafNode()||t.forEachChild(at,((t,r)=>{if(e.hasChild(t)){const o=e.getImmediateChild(t);o.equals(r)||n.trackChildChange(St(t,r,o))}else n.trackChildChange(Tt(t,r))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?gt.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class kt{constructor(e){this.indexedFilter_=new It(e.getIndex()),this.index_=e.getIndex(),this.startPost_=kt.getStartPost_(e),this.endPost_=kt.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,source,o){return this.matches(new Ve(t,n))||(n=gt.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,source,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=gt.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(gt.EMPTY_NODE);const o=this;return t.forEachChild(at,((e,t)=>{o.matches(new Ve(e,t))||(r=r.updateImmediateChild(e,gt.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Et{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new kt(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,source,o){return this.rangedFilter_.matches(new Ve(t,n))||(n=gt.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,source,o):this.fullLimitUpdateChild_(e,t,n,source,o)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=gt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=gt.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;r=r.updateImmediateChild(t.name,t.node),n++}}}else{let e;r=t.withIndex(this.index_),r=r.updatePriority(gt.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,gt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,source,r){let o;if(this.reverse_){const e=this.index_.getCompare();o=(a,b)=>e(b,a)}else o=this.index_.getCompare();const c=e;Object(l.e)(c.numChildren()===this.limit_,"");const h=new Ve(t,n),d=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),_=this.rangedFilter_.matches(h);if(c.hasChild(t)){const e=c.getImmediateChild(t);let l=source.getChildAfterChild(this.index_,d,this.reverse_);for(;null!=l&&(l.name===t||c.hasChild(l.name));)l=source.getChildAfterChild(this.index_,l,this.reverse_);const f=null==l?1:o(l,h);if(_&&!n.isEmpty()&&f>=0)return null!=r&&r.trackChildChange(St(t,n,e)),c.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(Ot(t,e));const n=c.updateImmediateChild(t,gt.EMPTY_NODE);return null!=l&&this.rangedFilter_.matches(l)?(null!=r&&r.trackChildChange(Tt(l.name,l.node)),n.updateImmediateChild(l.name,l.node)):n}}return n.isEmpty()?e:_&&o(d,h)>=0?(null!=r&&(r.trackChildChange(Ot(d.name,d.node)),r.trackChildChange(Tt(t,n))),c.updateImmediateChild(t,n).updateImmediateChild(d.name,gt.EMPTY_NODE)):e}}class Pt{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=at}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Object(l.e)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Object(l.e)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:F}hasEnd(){return this.endSet_}getIndexEndValue(){return Object(l.e)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Object(l.e)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:L}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Object(l.e)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===at}copy(){const e=new Pt;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Nt(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function xt(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function jt(e,t){const n=e.copy();return n.index_=t,n}function Rt(e){const t={};if(e.isDefault())return t;let n;if(e.index_===at?n="$priority":e.index_===wt?n="$value":e.index_===Ye?n="$key":(Object(l.e)(e.index_ instanceof bt,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Object(l.R)(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=Object(l.R)(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+Object(l.R)(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=Object(l.R)(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+Object(l.R)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Dt(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==at&&(t.i=e.index_.toString()),t}class At extends ye{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=x("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Object(l.e)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);const c=At.getListenId_(e,n),h={};this.listens_[c]=h;const d=Rt(e._queryParams);this.restRequest_(o+".json",d,((e,t)=>{let data=t;if(404===e&&(data=null,e=null),null===e&&this.onDataUpdate_(o,data,!1,n),Object(l.O)(this.listens_,c)===h){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}}))}unlisten(e,t){const n=At.getListenId_(e,t);delete this.listens_[n]}get(e){const t=Rt(e._queryParams),n=e._path.toString(),r=new l.a;return this.restRequest_(n+".json",t,((e,t)=>{let data=t;404===e&&(data=null,e=null),null===e?(this.onDataUpdate_(n,data,!1,null),r.resolve(data)):r.reject(new Error(data))})),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([r,o])=>{r&&r.accessToken&&(t.auth=r.accessToken),o&&o.token&&(t.ac=o.token);const c=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Object(l.M)(t);this.log_("Sending REST request for "+c);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(n&&4===h.readyState){this.log_("REST Response for "+c+" received. status:",h.status,"response:",h.responseText);let e=null;if(h.status>=200&&h.status<300){try{e=Object(l.K)(h.responseText)}catch(e){D("Failed to parse JSON response for "+c+": "+h.responseText)}n(null,e)}else 401!==h.status&&404!==h.status&&D("Got unsuccessful REST response for "+c+" Status: "+h.status),n(h.status);n=null}},h.open("GET",c,!0),h.send()}))}}class qt{constructor(){this.rootNode_=gt.EMPTY_NODE}getNode(path){return this.rootNode_.getChild(path)}updateSnapshot(path,e){this.rootNode_=this.rootNode_.updateChild(path,e)}}function Ft(){return{value:null,children:new Map}}function Lt(e,path,data){if(je(path))e.value=data,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(path,data);else{const t=Se(path);e.children.has(t)||e.children.set(t,Ft());Lt(e.children.get(t),path=ke(path),data)}}function Mt(e,path){if(je(path))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const t=e.value;return e.value=null,t.forEachChild(at,((t,n)=>{Lt(e,new Te(t),n)})),Mt(e,path)}}if(e.children.size>0){const t=Se(path);if(path=ke(path),e.children.has(t)){Mt(e.children.get(t),path)&&e.children.delete(t)}return 0===e.children.size}return!0}function Wt(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,r)=>{Wt(r,new Te(t.toString()+"/"+e),n)}))}class Ut{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&H(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Bt{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ut(e);const n=1e4+2e4*Math.random();G(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;H(e,((e,r)=>{r>0&&Object(l.k)(this.statsToReport_,e)&&(t[e]=r,n=!0)})),n&&this.server_.reportStats(t),G(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Vt;function Ht(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Vt||(Vt={}));class Qt{constructor(path,e,t){this.path=path,this.affectedTree=e,this.revert=t,this.type=Vt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(je(this.path)){if(null!=this.affectedTree.value)return Object(l.e)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Te(e));return new Qt(Oe(),t,this.revert)}}return Object(l.e)(Se(this.path)===e,"operationForChild called for unrelated child."),new Qt(ke(this.path),this.affectedTree,this.revert)}}class zt{constructor(source,path){this.source=source,this.path=path,this.type=Vt.LISTEN_COMPLETE}operationForChild(e){return je(this.path)?new zt(this.source,Oe()):new zt(this.source,ke(this.path))}}class Yt{constructor(source,path,e){this.source=source,this.path=path,this.snap=e,this.type=Vt.OVERWRITE}operationForChild(e){return je(this.path)?new Yt(this.source,Oe(),this.snap.getImmediateChild(e)):new Yt(this.source,ke(this.path),this.snap)}}class Kt{constructor(source,path,e){this.source=source,this.path=path,this.children=e,this.type=Vt.MERGE}operationForChild(e){if(je(this.path)){const t=this.children.subtree(new Te(e));return t.isEmpty()?null:t.value?new Yt(this.source,Oe(),t.value):new Kt(this.source,Oe(),t)}return Object(l.e)(Se(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Kt(this.source,ke(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Gt{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(path){if(je(path))return this.isFullyInitialized()&&!this.filtered_;const e=Se(path);return this.isCompleteForChild(e)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class $t{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Jt(e,t,n,r,o,c){const h=r.filter((e=>e.type===n));h.sort(((a,b)=>function(e,a,b){if(null==a.childName||null==b.childName)throw Object(l.f)("Should only compare child_ events.");const t=new Ve(a.childName,a.snapshotNode),n=new Ve(b.childName,b.snapshotNode);return e.index_.compare(t,n)}(e,a,b))),h.forEach((n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,c);o.forEach((o=>{o.respondsTo(n.type)&&t.push(o.createEvent(r,e.query_))}))}))}function Xt(e,t){return{eventCache:e,serverCache:t}}function Zt(e,t,n,r){return Xt(new Gt(t,n,r),e.serverCache)}function en(e,t,n,r){return Xt(e.eventCache,new Gt(t,n,r))}function tn(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function nn(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let rn;class sn{constructor(e,t=(()=>(rn||(rn=new $e(W)),rn))()){this.value=e,this.children=t}static fromObject(e){let t=new sn(null);return H(e,((e,n)=>{t=t.set(new Te(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Oe(),value:this.value};if(je(e))return null;{const n=Se(e),r=this.children.get(n);if(null!==r){const o=r.findRootMostMatchingPathAndValue(ke(e),t);if(null!=o){return{path:xe(new Te(n),o.path),value:o.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(je(e))return this;{const t=Se(e),n=this.children.get(t);return null!==n?n.subtree(ke(e)):new sn(null)}}set(e,t){if(je(e))return new sn(t,this.children);{const n=Se(e),r=(this.children.get(n)||new sn(null)).set(ke(e),t),o=this.children.insert(n,r);return new sn(this.value,o)}}remove(e){if(je(e))return this.children.isEmpty()?new sn(null):new sn(null,this.children);{const t=Se(e),n=this.children.get(t);if(n){const r=n.remove(ke(e));let o;return o=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&o.isEmpty()?new sn(null):new sn(this.value,o)}return this}}get(e){if(je(e))return this.value;{const t=Se(e),n=this.children.get(t);return n?n.get(ke(e)):null}}setTree(e,t){if(je(e))return t;{const n=Se(e),r=(this.children.get(n)||new sn(null)).setTree(ke(e),t);let o;return o=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new sn(this.value,o)}}fold(e){return this.fold_(Oe(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((r,o)=>{n[r]=o.fold_(xe(e,r),t)})),t(e,this.value,n)}findOnPath(path,e){return this.findOnPath_(path,Oe(),e)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(je(e))return null;{const r=Se(e),o=this.children.get(r);return o?o.findOnPath_(ke(e),xe(t,r),n):null}}foreachOnPath(path,e){return this.foreachOnPath_(path,Oe(),e)}foreachOnPath_(e,t,n){if(je(e))return this;{this.value&&n(t,this.value);const r=Se(e),o=this.children.get(r);return o?o.foreachOnPath_(ke(e),xe(t,r),n):new sn(null)}}foreach(e){this.foreach_(Oe(),e)}foreach_(e,t){this.children.inorderTraversal(((n,r)=>{r.foreach_(xe(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class on{constructor(e){this.writeTree_=e}static empty(){return new on(new sn(null))}}function an(e,path,t){if(je(path))return new on(new sn(t));{const n=e.writeTree_.findRootMostValueAndPath(path);if(null!=n){const r=n.path;let o=n.value;const l=Re(r,path);return o=o.updateChild(l,t),new on(e.writeTree_.set(r,o))}{const n=new sn(t),r=e.writeTree_.setTree(path,n);return new on(r)}}}function ln(e,path,t){let n=e;return H(t,((e,t)=>{n=an(n,xe(path,e),t)})),n}function cn(e,path){if(je(path))return on.empty();{const t=e.writeTree_.setTree(path,new sn(null));return new on(t)}}function hn(e,path){return null!=un(e,path)}function un(e,path){const t=e.writeTree_.findRootMostValueAndPath(path);return null!=t?e.writeTree_.get(t.path).getChild(Re(t.path,path)):null}function dn(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(at,((e,n)=>{t.push(new Ve(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new Ve(e,n.value))})),t}function _n(e,path){if(je(path))return e;{const t=un(e,path);return new on(null!=t?new sn(t):e.writeTree_.subtree(path))}}function pn(e){return e.writeTree_.isEmpty()}function fn(e,t){return gn(Oe(),e.writeTree_,t)}function gn(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,o)=>{".priority"===t?(Object(l.e)(null!==o.value,"Priority writes must always be leaf nodes"),r=o.value):n=gn(xe(e,t),o,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(xe(e,".priority"),r)),n}}function mn(e,path){return Nn(path,e)}function yn(e,t){const n=e.allWrites.findIndex((s=>s.writeId===t));Object(l.e)(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let o=r.visible,c=!1,i=e.allWrites.length-1;for(;o&&i>=0;){const t=e.allWrites[i];t.visible&&(i>=n&&vn(t,r.path)?o=!1:qe(r.path,t.path)&&(c=!0)),i--}if(o){if(c)return function(e){e.visibleWrites=wn(e.allWrites,bn,Oe()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(r.snap)e.visibleWrites=cn(e.visibleWrites,r.path);else{H(r.children,(t=>{e.visibleWrites=cn(e.visibleWrites,xe(r.path,t))}))}return!0}return!1}function vn(e,path){if(e.snap)return qe(e.path,path);for(const t in e.children)if(e.children.hasOwnProperty(t)&&qe(xe(e.path,t),path))return!0;return!1}function bn(e){return e.visible}function wn(e,filter,t){let n=on.empty();for(let i=0;i<e.length;++i){const r=e[i];if(filter(r)){const e=r.path;let o;if(r.snap)qe(t,e)?(o=Re(t,e),n=an(n,o,r.snap)):qe(e,t)&&(o=Re(e,t),n=an(n,Oe(),r.snap.getChild(o)));else{if(!r.children)throw Object(l.f)("WriteRecord should have .snap or .children");if(qe(t,e))o=Re(t,e),n=ln(n,o,r.children);else if(qe(e,t))if(o=Re(e,t),je(o))n=ln(n,Oe(),r.children);else{const e=Object(l.O)(r.children,Se(o));if(e){const t=e.getChild(ke(o));n=an(n,Oe(),t)}}}}}return n}function Cn(e,t,n,r,o){if(r||o){const l=_n(e.visibleWrites,t);if(!o&&pn(l))return n;if(o||null!=n||hn(l,Oe())){const filter=function(e){return(e.visible||o)&&(!r||!~r.indexOf(e.writeId))&&(qe(e.path,t)||qe(t,e.path))};return fn(wn(e.allWrites,filter,t),n||gt.EMPTY_NODE)}return null}{const r=un(e.visibleWrites,t);if(null!=r)return r;{const r=_n(e.visibleWrites,t);if(pn(r))return n;if(null!=n||hn(r,Oe())){return fn(r,n||gt.EMPTY_NODE)}return null}}}function Tn(e,t,n,r){return Cn(e.writeTree,e.treePath,t,n,r)}function On(e,t){return function(e,t,n){let r=gt.EMPTY_NODE;const o=un(e.visibleWrites,t);if(o)return o.isLeafNode()||o.forEachChild(at,((e,t)=>{r=r.updateImmediateChild(e,t)})),r;if(n){const o=_n(e.visibleWrites,t);return n.forEachChild(at,((e,t)=>{const n=fn(_n(o,new Te(e)),t);r=r.updateImmediateChild(e,n)})),dn(o).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}return dn(_n(e.visibleWrites,t)).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function Sn(e,path,t,n){return function(e,t,n,r,o){Object(l.e)(r||o,"Either existingEventSnap or existingServerSnap must exist");const path=xe(t,n);if(hn(e.visibleWrites,path))return null;{const t=_n(e.visibleWrites,path);return pn(t)?o.getChild(n):fn(t,o.getChild(n))}}(e.writeTree,e.treePath,path,t,n)}function In(e,path){return function(e,path){return un(e.visibleWrites,path)}(e.writeTree,xe(e.treePath,path))}function kn(e,t,n,r,o,l){return function(e,t,n,r,o,l,c){let h;const d=_n(e.visibleWrites,t),_=un(d,Oe());if(null!=_)h=_;else{if(null==n)return[];h=fn(d,n)}if(h=h.withIndex(c),h.isEmpty()||h.isLeafNode())return[];{const e=[],t=c.getCompare(),n=l?h.getReverseIteratorFrom(r,c):h.getIteratorFrom(r,c);let d=n.getNext();for(;d&&e.length<o;)0!==t(d,r)&&e.push(d),d=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,o,l)}function En(e,t,n){return function(e,t,n,r){const path=xe(t,n),o=un(e.visibleWrites,path);if(null!=o)return o;if(r.isCompleteForChild(n))return fn(_n(e.visibleWrites,path),r.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function Pn(e,t){return Nn(xe(e.treePath,t),e.writeTree)}function Nn(path,e){return{treePath:path,writeTree:e}}class xn{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;Object(l.e)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Object(l.e)(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const o=r.type;if("child_added"===t&&"child_removed"===o)this.changeMap.set(n,St(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===o)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===o)this.changeMap.set(n,Ot(n,r.oldSnap));else if("child_changed"===t&&"child_added"===o)this.changeMap.set(n,Tt(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==o)throw Object(l.f)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,St(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const jn=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Rn{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Gt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return En(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:nn(this.viewCache_),o=kn(this.writes_,r,t,1,n,e);return 0===o.length?null:o[0]}}function Dn(e,t,n,r,o){const c=new xn;let h,d;if(n.type===Vt.OVERWRITE){const _=n;_.source.fromUser?h=Fn(e,t,_.path,_.snap,r,o,c):(Object(l.e)(_.source.fromServer,"Unknown source."),d=_.source.tagged||t.serverCache.isFiltered()&&!je(_.path),h=qn(e,t,_.path,_.snap,r,o,d,c))}else if(n.type===Vt.MERGE){const _=n;_.source.fromUser?h=function(e,t,path,n,r,o,l){let c=t;return n.foreach(((n,h)=>{const d=xe(path,n);Ln(t,Se(d))&&(c=Fn(e,c,d,h,r,o,l))})),n.foreach(((n,h)=>{const d=xe(path,n);Ln(t,Se(d))||(c=Fn(e,c,d,h,r,o,l))})),c}(e,t,_.path,_.children,r,o,c):(Object(l.e)(_.source.fromServer,"Unknown source."),d=_.source.tagged||t.serverCache.isFiltered(),h=Wn(e,t,_.path,_.children,r,o,d,c))}else if(n.type===Vt.ACK_USER_WRITE){const d=n;h=d.revert?function(e,t,path,n,r,o){let c;if(null!=In(n,path))return t;{const source=new Rn(n,t,r),h=t.eventCache.getNode();let d;if(je(path)||".priority"===Se(path)){let r;if(t.serverCache.isFullyInitialized())r=Tn(n,nn(t));else{const e=t.serverCache.getNode();Object(l.e)(e instanceof gt,"serverChildren would be complete if leaf node"),r=On(n,e)}d=e.filter.updateFullNode(h,r,o)}else{const r=Se(path);let l=En(n,r,t.serverCache);null==l&&t.serverCache.isCompleteForChild(r)&&(l=h.getImmediateChild(r)),d=null!=l?e.filter.updateChild(h,r,l,ke(path),source,o):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,gt.EMPTY_NODE,ke(path),source,o):h,d.isEmpty()&&t.serverCache.isFullyInitialized()&&(c=Tn(n,nn(t)),c.isLeafNode()&&(d=e.filter.updateFullNode(d,c,o)))}return c=t.serverCache.isFullyInitialized()||null!=In(n,Oe()),Zt(t,d,c,e.filter.filtersNodes())}}(e,t,d.path,r,o,c):function(e,t,n,r,o,l,c){if(null!=In(o,n))return t;const h=t.serverCache.isFiltered(),d=t.serverCache;if(null!=r.value){if(je(n)&&d.isFullyInitialized()||d.isCompleteForPath(n))return qn(e,t,n,d.getNode().getChild(n),o,l,h,c);if(je(n)){let r=new sn(null);return d.getNode().forEachChild(Ye,((e,t)=>{r=r.set(new Te(e),t)})),Wn(e,t,n,r,o,l,h,c)}return t}{let _=new sn(null);return r.foreach(((e,t)=>{const r=xe(n,e);d.isCompleteForPath(r)&&(_=_.set(e,d.getNode().getChild(r)))})),Wn(e,t,n,_,o,l,h,c)}}(e,t,d.path,d.affectedTree,r,o,c)}else{if(n.type!==Vt.LISTEN_COMPLETE)throw Object(l.f)("Unknown operation type: "+n.type);h=function(e,t,path,n,r){const o=t.serverCache,l=en(t,o.getNode(),o.isFullyInitialized()||je(path),o.isFiltered());return An(e,l,path,n,jn,r)}(e,t,n.path,r,c)}const _=c.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const o=r.getNode().isLeafNode()||r.getNode().isEmpty(),l=tn(e);(n.length>0||!e.eventCache.isFullyInitialized()||o&&!r.getNode().equals(l)||!r.getNode().getPriority().equals(l.getPriority()))&&n.push(Ct(tn(t)))}}(t,h,_),{viewCache:h,changes:_}}function An(e,t,n,r,source,o){const c=t.eventCache;if(null!=In(r,n))return t;{let h,d;if(je(n))if(Object(l.e)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=nn(t),l=On(r,n instanceof gt?n:gt.EMPTY_NODE);h=e.filter.updateFullNode(t.eventCache.getNode(),l,o)}else{const n=Tn(r,nn(t));h=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const _=Se(n);if(".priority"===_){Object(l.e)(1===Ie(n),"Can't have a priority with additional path components");const o=c.getNode();d=t.serverCache.getNode();const _=Sn(r,n,o,d);h=null!=_?e.filter.updatePriority(o,_):c.getNode()}else{const l=ke(n);let f;if(c.isCompleteForChild(_)){d=t.serverCache.getNode();const e=Sn(r,n,c.getNode(),d);f=null!=e?c.getNode().getImmediateChild(_).updateChild(l,e):c.getNode().getImmediateChild(_)}else f=En(r,_,t.serverCache);h=null!=f?e.filter.updateChild(c.getNode(),_,f,l,source,o):c.getNode()}}return Zt(t,h,c.isFullyInitialized()||je(n),e.filter.filtersNodes())}}function qn(e,t,n,r,o,l,c,h){const d=t.serverCache;let _;const f=c?e.filter:e.filter.getIndexedFilter();if(je(n))_=f.updateFullNode(d.getNode(),r,null);else if(f.filtersNodes()&&!d.isFiltered()){const e=d.getNode().updateChild(n,r);_=f.updateFullNode(d.getNode(),e,null)}else{const e=Se(n);if(!d.isCompleteForPath(n)&&Ie(n)>1)return t;const o=ke(n),l=d.getNode().getImmediateChild(e).updateChild(o,r);_=".priority"===e?f.updatePriority(d.getNode(),l):f.updateChild(d.getNode(),e,l,o,jn,null)}const m=en(t,_,d.isFullyInitialized()||je(n),f.filtersNodes());return An(e,m,n,o,new Rn(o,m,l),h)}function Fn(e,t,n,r,o,l,c){const h=t.eventCache;let d,_;const source=new Rn(o,t,l);if(je(n))_=e.filter.updateFullNode(t.eventCache.getNode(),r,c),d=Zt(t,_,!0,e.filter.filtersNodes());else{const o=Se(n);if(".priority"===o)_=e.filter.updatePriority(t.eventCache.getNode(),r),d=Zt(t,_,h.isFullyInitialized(),h.isFiltered());else{const l=ke(n),_=h.getNode().getImmediateChild(o);let f;if(je(l))f=r;else{const e=source.getCompleteChild(o);f=null!=e?".priority"===Ee(l)&&e.getChild(Ne(l)).isEmpty()?e:e.updateChild(l,r):gt.EMPTY_NODE}if(_.equals(f))d=t;else{d=Zt(t,e.filter.updateChild(h.getNode(),o,f,l,source,c),h.isFullyInitialized(),e.filter.filtersNodes())}}}return d}function Ln(e,t){return e.eventCache.isCompleteForChild(t)}function Mn(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Wn(e,t,path,n,r,o,l,c){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h,d=t;h=je(path)?n:new sn(null).setTree(path,n);const _=t.serverCache.getNode();return h.children.inorderTraversal(((n,h)=>{if(_.hasChild(n)){const _=Mn(0,t.serverCache.getNode().getImmediateChild(n),h);d=qn(e,d,new Te(n),_,r,o,l,c)}})),h.children.inorderTraversal(((n,h)=>{const f=!t.serverCache.isCompleteForChild(n)&&null===h.value;if(!_.hasChild(n)&&!f){const _=Mn(0,t.serverCache.getNode().getImmediateChild(n),h);d=qn(e,d,new Te(n),_,r,o,l,c)}})),d}class Un{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new It(n.getIndex()),filter=(o=n).loadsAllData()?new It(o.getIndex()):o.hasLimit()?new Et(o):new kt(o);var o;this.processor_=function(filter){return{filter:filter}}(filter);const l=t.serverCache,c=t.eventCache,h=r.updateFullNode(gt.EMPTY_NODE,l.getNode(),null),d=filter.updateFullNode(gt.EMPTY_NODE,c.getNode(),null),_=new Gt(h,l.isFullyInitialized(),r.filtersNodes()),f=new Gt(d,c.isFullyInitialized(),filter.filtersNodes());this.viewCache_=Xt(f,_),this.eventGenerator_=new $t(this.query_)}get query(){return this.query_}}function Bn(view,path){const e=nn(view.viewCache_);return e&&(view.query._queryParams.loadsAllData()||!je(path)&&!e.getImmediateChild(Se(path)).isEmpty())?e.getChild(path):null}function Vn(view){return 0===view.eventRegistrations_.length}function Hn(view,e,t){const n=[];if(t){Object(l.e)(null==e,"A cancel should cancel all event registrations.");const path=view.query._path;view.eventRegistrations_.forEach((e=>{const r=e.createCancelEvent(t,path);r&&n.push(r)}))}if(e){let t=[];for(let i=0;i<view.eventRegistrations_.length;++i){const n=view.eventRegistrations_[i];if(n.matches(e)){if(e.hasAnyCallback()){t=t.concat(view.eventRegistrations_.slice(i+1));break}}else t.push(n)}view.eventRegistrations_=t}else view.eventRegistrations_=[];return n}function Qn(view,e,t,n){e.type===Vt.MERGE&&null!==e.source.queryId&&(Object(l.e)(nn(view.viewCache_),"We should always have a full cache before handling merges"),Object(l.e)(tn(view.viewCache_),"Missing event cache, even though we have a server cache"));const r=view.viewCache_,o=Dn(view.processor_,r,e,t,n);var c,h;return c=view.processor_,h=o.viewCache,Object(l.e)(h.eventCache.getNode().isIndexed(c.filter.getIndex()),"Event snap not indexed"),Object(l.e)(h.serverCache.getNode().isIndexed(c.filter.getIndex()),"Server snap not indexed"),Object(l.e)(o.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),view.viewCache_=o.viewCache,zn(view,o.changes,o.viewCache.eventCache.getNode(),null)}function zn(view,e,t,n){const r=n?[n]:view.eventRegistrations_;return function(e,t,n,r){const o=[],l=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&l.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Jt(e,o,"child_removed",t,r,n),Jt(e,o,"child_added",t,r,n),Jt(e,o,"child_moved",l,r,n),Jt(e,o,"child_changed",t,r,n),Jt(e,o,"value",t,r,n),o}(view.eventGenerator_,e,t,r)}let Yn,Kn;class Gn{constructor(){this.views=new Map}}function $n(e,t,n,r){const o=t.source.queryId;if(null!==o){const view=e.views.get(o);return Object(l.e)(null!=view,"SyncTree gave us an op for an invalid query."),Qn(view,t,n,r)}{let o=[];for(const view of e.views.values())o=o.concat(Qn(view,t,n,r));return o}}function Jn(e,t,n,r,o){const l=t._queryIdentifier,view=e.views.get(l);if(!view){let e=Tn(n,o?r:null),l=!1;e?l=!0:r instanceof gt?(e=On(n,r),l=!1):(e=gt.EMPTY_NODE,l=!1);const c=Xt(new Gt(e,l,!1),new Gt(r,o,!1));return new Un(t,c)}return view}function Xn(e,t,n,r,o,l){const view=Jn(e,t,r,o,l);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,view),function(view,e){view.eventRegistrations_.push(e)}(view,n),function(view,e){const t=view.viewCache_.eventCache,n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(at,((e,t)=>{n.push(Tt(e,t))}));return t.isFullyInitialized()&&n.push(Ct(t.getNode())),zn(view,n,t.getNode(),e)}(view,n)}function Zn(e,t,n,r){const o=t._queryIdentifier,c=[];let h=[];const d=ri(e);if("default"===o)for(const[t,view]of e.views.entries())h=h.concat(Hn(view,n,r)),Vn(view)&&(e.views.delete(t),view.query._queryParams.loadsAllData()||c.push(view.query));else{const view=e.views.get(o);view&&(h=h.concat(Hn(view,n,r)),Vn(view)&&(e.views.delete(o),view.query._queryParams.loadsAllData()||c.push(view.query)))}return d&&!ri(e)&&c.push(new(Object(l.e)(Yn,"Reference.ts has not been loaded"),Yn)(t._repo,t._path)),{removed:c,events:h}}function ei(e){const t=[];for(const view of e.views.values())view.query._queryParams.loadsAllData()||t.push(view);return t}function ti(e,path){let t=null;for(const view of e.views.values())t=t||Bn(view,path);return t}function ni(e,t){if(t._queryParams.loadsAllData())return si(e);{const n=t._queryIdentifier;return e.views.get(n)}}function ii(e,t){return null!=ni(e,t)}function ri(e){return null!=si(e)}function si(e){for(const view of e.views.values())if(view.query._queryParams.loadsAllData())return view;return null}let oi=1;class ai{constructor(e){this.listenProvider_=e,this.syncPointTree_=new sn(null),this.pendingWriteTree_={visibleWrites:on.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function ci(e,path,t,n,r){return function(e,path,t,n,r){Object(l.e)(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:path,snap:t,writeId:n,visible:r}),r&&(e.visibleWrites=an(e.visibleWrites,path,t)),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n,r),r?yi(e,new Yt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,t)):[]}function hi(e,path,t,n){!function(e,path,t,n){Object(l.e)(n>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:path,children:t,writeId:n,visible:!0}),e.visibleWrites=ln(e.visibleWrites,path,t),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n);const r=sn.fromObject(t);return yi(e,new Kt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,r))}function ui(e,t,n=!1){const r=function(e,t){for(let i=0;i<e.allWrites.length;i++){const n=e.allWrites[i];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(yn(e.pendingWriteTree_,t)){let t=new sn(null);return null!=r.snap?t=t.set(Oe(),!0):H(r.children,(e=>{t=t.set(new Te(e),!0)})),yi(e,new Qt(r.path,t,n))}return[]}function di(e,path,t){return yi(e,new Yt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,t))}function _i(e,t,n,r,o=!1){const path=t._path,l=e.syncPointTree_.get(path);let c=[];if(l&&("default"===t._queryIdentifier||ii(l,t))){const h=Zn(l,t,n,r);0===l.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(path));const d=h.removed;if(c=h.events,!o){const n=-1!==d.findIndex((e=>e._queryParams.loadsAllData())),o=e.syncPointTree_.findOnPath(path,((e,t)=>ri(t)));if(n&&!o){const t=e.syncPointTree_.subtree(path);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&ri(t)){return[si(t)]}{let e=[];return t&&(e=ei(t)),H(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let i=0;i<n.length;++i){const view=n[i],t=view.query,r=wi(e,view);e.listenProvider_.startListening(ki(t),Ci(e,t),r.hashFn,r.onComplete)}}}if(!o&&d.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(ki(t),n)}else d.forEach((t=>{const n=e.queryToTagMap.get(Ti(t));e.listenProvider_.stopListening(ki(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const r=t[n];if(!r._queryParams.loadsAllData()){const t=Ti(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,d)}return c}function pi(e,path,t,n){const r=Oi(e,n);if(null!=r){const n=Si(r),o=n.path,l=n.queryId,c=Re(o,path);return Ii(e,o,new Yt(Ht(l),c,t))}return[]}function fi(e,t,n,r=!1){const path=t._path;let o=null,c=!1;e.syncPointTree_.foreachOnPath(path,((e,t)=>{const n=Re(e,path);o=o||ti(t,n),c=c||ri(t)}));let h,d=e.syncPointTree_.get(path);if(d?(c=c||ri(d),o=o||ti(d,Oe())):(d=new Gn,e.syncPointTree_=e.syncPointTree_.set(path,d)),null!=o)h=!0;else{h=!1,o=gt.EMPTY_NODE;e.syncPointTree_.subtree(path).foreachChild(((e,t)=>{const n=ti(t,Oe());n&&(o=o.updateImmediateChild(e,n))}))}const _=ii(d,t);if(!_&&!t._queryParams.loadsAllData()){const n=Ti(t);Object(l.e)(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=oi++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let f=Xn(d,t,n,mn(e.pendingWriteTree_,path),o,h);if(!_&&!c&&!r){const view=ni(d,t);f=f.concat(function(e,t,view){const path=t._path,n=Ci(e,t),r=wi(e,view),o=e.listenProvider_.startListening(ki(t),n,r.hashFn,r.onComplete),c=e.syncPointTree_.subtree(path);if(n)Object(l.e)(!ri(c.value),"If we're adding a query, it shouldn't be shadowed");else{const t=c.fold(((e,t,n)=>{if(!je(e)&&t&&ri(t))return[si(t).query];{let e=[];return t&&(e=e.concat(ei(t).map((view=>view.query)))),H(n,((t,n)=>{e=e.concat(n)})),e}}));for(let i=0;i<t.length;++i){const n=t[i];e.listenProvider_.stopListening(ki(n),Ci(e,n))}}return o}(e,t,view))}return f}function gi(e,path,t){const n=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(path,((e,t)=>{const n=ti(t,Re(e,path));if(n)return n}));return Cn(n,path,r,t,!0)}function mi(e,t){const path=t._path;let n=null;e.syncPointTree_.foreachOnPath(path,((e,t)=>{const r=Re(e,path);n=n||ti(t,r)}));let r=e.syncPointTree_.get(path);r?n=n||ti(r,Oe()):(r=new Gn,e.syncPointTree_=e.syncPointTree_.set(path,r));const o=null!=n,l=o?new Gt(n,!0,!1):null;return function(view){return tn(view.viewCache_)}(Jn(r,t,mn(e.pendingWriteTree_,t._path),o?l.getNode():gt.EMPTY_NODE,o))}function yi(e,t){return vi(t,e.syncPointTree_,null,mn(e.pendingWriteTree_,Oe()))}function vi(e,t,n,r){if(je(e.path))return bi(e,t,n,r);{const o=t.get(Oe());null==n&&null!=o&&(n=ti(o,Oe()));let l=[];const c=Se(e.path),h=e.operationForChild(c),d=t.children.get(c);if(d&&h){const e=n?n.getImmediateChild(c):null,t=Pn(r,c);l=l.concat(vi(h,d,e,t))}return o&&(l=l.concat($n(o,e,r,n))),l}}function bi(e,t,n,r){const o=t.get(Oe());null==n&&null!=o&&(n=ti(o,Oe()));let l=[];return t.children.inorderTraversal(((t,o)=>{const c=n?n.getImmediateChild(t):null,h=Pn(r,t),d=e.operationForChild(t);d&&(l=l.concat(bi(d,o,c,h)))})),o&&(l=l.concat($n(o,e,r,n))),l}function wi(e,view){const t=view.query,n=Ci(e,t);return{hashFn:()=>{const e=function(view){return view.viewCache_.serverCache.getNode()}(view)||gt.EMPTY_NODE;return e.hash()},onComplete:r=>{if("ok"===r)return n?function(e,path,t){const n=Oi(e,t);if(n){const t=Si(n),r=t.path,o=t.queryId,l=Re(r,path);return Ii(e,r,new zt(Ht(o),l))}return[]}(e,t._path,n):function(e,path){return yi(e,new zt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path))}(e,t._path);{const n=function(code,e){let t="Unknown Error";"too_big"===code?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===code?t="Client doesn't have permission to access the desired data.":"unavailable"===code&&(t="The service is unavailable");const n=new Error(code+" at "+e._path.toString()+": "+t);return n.code=code.toUpperCase(),n}(r,t);return _i(e,t,null,n)}}}}function Ci(e,t){const n=Ti(t);return e.queryToTagMap.get(n)}function Ti(e){return e._path.toString()+"$"+e._queryIdentifier}function Oi(e,t){return e.tagToQueryMap.get(t)}function Si(e){const t=e.indexOf("$");return Object(l.e)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Te(e.substr(0,t))}}function Ii(e,t,n){const r=e.syncPointTree_.get(t);Object(l.e)(r,"Missing sync point for query tag that we're tracking");return $n(r,n,mn(e.pendingWriteTree_,t),null)}function ki(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(Object(l.e)(Kn,"Reference.ts has not been loaded"),Kn)(e._repo,e._path):e}class Ei{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Ei(t)}node(){return this.node_}}class Pi{constructor(e,path){this.syncTree_=e,this.path_=path}getImmediateChild(e){const t=xe(this.path_,e);return new Pi(this.syncTree_,t)}node(){return gi(this.syncTree_,this.path_)}}const Ni=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},xi=function(e,t,n){return e&&"object"==typeof e?(Object(l.e)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?ji(e[".sv"],t,n):"object"==typeof e[".sv"]?Ri(e[".sv"],t):void Object(l.e)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},ji=function(e,t,n){if("timestamp"===e)return n.timestamp;Object(l.e)(!1,"Unexpected server value: "+e)},Ri=function(e,t,n){e.hasOwnProperty("increment")||Object(l.e)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&Object(l.e)(!1,"Unexpected increment value: "+r);const o=t.node();if(Object(l.e)(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return r;const c=o.getValue();return"number"!=typeof c?r:c+r},Di=function(path,e,t,n){return qi(e,new Pi(t,path),n)},Ai=function(e,t,n){return qi(e,new Ei(t),n)};function qi(e,t,n){const r=e.getPriority().val(),o=xi(r,t.getImmediateChild(".priority"),n);let l;if(e.isLeafNode()){const r=e,l=xi(r.getValue(),t,n);return l!==r.getValue()||o!==r.getPriority().val()?new ot(l,vt(o)):e}{const r=e;return l=r,o!==r.getPriority().val()&&(l=l.updatePriority(new ot(o))),r.forEachChild(at,((e,r)=>{const o=qi(r,t.getImmediateChild(e),n);o!==r&&(l=l.updateImmediateChild(e,o))})),l}}class Fi{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Li(e,t){let path=t instanceof Te?t:new Te(t),n=e,r=Se(path);for(;null!==r;){const e=Object(l.O)(n.node.children,r)||{children:{},childCount:0};n=new Fi(r,n,e),path=ke(path),r=Se(path)}return n}function Mi(e){return e.node.value}function Wi(e,t){e.node.value=t,Qi(e)}function Ui(e){return e.node.childCount>0}function Bi(e,t){H(e.node.children,((n,r)=>{t(new Fi(n,e,r))}))}function Vi(e,t,n,r){n&&!r&&t(e),Bi(e,(e=>{Vi(e,t,!0,r)})),n&&r&&t(e)}function Hi(e){return new Te(null===e.parent?e.name:Hi(e.parent)+"/"+e.name)}function Qi(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===Mi(e)&&!Ui(e)}(n),o=Object(l.k)(e.node.children,t);r&&o?(delete e.node.children[t],e.node.childCount--,Qi(e)):r||o||(e.node.children[t]=n.node,e.node.childCount++,Qi(e))}(e.parent,e.name,e)}const zi=/[\[\].#$\/\u0000-\u001F\u007F]/,Yi=/[\[\].#$\u0000-\u001F\u007F]/,Ki=10485760,Gi=function(e){return"string"==typeof e&&0!==e.length&&!zi.test(e)},$i=function(e){return"string"==typeof e&&0!==e.length&&!Yi.test(e)},Ji=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!A(e)||e&&"object"==typeof e&&Object(l.k)(e,".sv")},Xi=function(e,t,path,n){n&&void 0===t||Zi(Object(l.q)(e,"value"),t,path)},Zi=function(e,data,t){const path=t instanceof Te?new Fe(t,e):t;if(void 0===data)throw new Error(e+"contains undefined "+Me(path));if("function"==typeof data)throw new Error(e+"contains a function "+Me(path)+" with contents = "+data.toString());if(A(data))throw new Error(e+"contains "+data.toString()+" "+Me(path));if("string"==typeof data&&data.length>Ki/3&&Object(l.P)(data)>Ki)throw new Error(e+"contains a string greater than "+Ki+" utf8 bytes "+Me(path)+" ('"+data.substring(0,50)+"...')");if(data&&"object"==typeof data){let t=!1,n=!1;if(H(data,((r,o)=>{if(".value"===r)t=!0;else if(".priority"!==r&&".sv"!==r&&(n=!0,!Gi(r)))throw new Error(e+" contains an invalid key ("+r+") "+Me(path)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=Object(l.P)(t),Le(e)}(path,r),Zi(e,o,path),function(e){const t=e.parts_.pop();e.byteLength_-=Object(l.P)(t),e.parts_.length>0&&(e.byteLength_-=1)}(path)})),t&&n)throw new Error(e+' contains ".value" child '+Me(path)+" in addition to actual children.")}},er=function(e,data,path,t){if(t&&void 0===data)return;const n=Object(l.q)(e,"values");if(!data||"object"!=typeof data||Array.isArray(data))throw new Error(n+" must be an object containing the children to replace.");const r=[];H(data,((e,t)=>{const o=new Te(e);if(Zi(n,t,xe(path,o)),".priority"===Ee(o)&&!Ji(t))throw new Error(n+"contains an invalid value for '"+o.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(o)})),function(e,t){let i,n;for(i=0;i<t.length;i++){n=t[i];const r=Pe(n);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!Gi(r[t]))throw new Error(e+"contains an invalid key ("+r[t]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(De);let r=null;for(i=0;i<t.length;i++){if(n=t[i],null!==r&&qe(r,n))throw new Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+n.toString());r=n}}(n,r)},nr=function(e,t,n){if(!n||void 0!==t){if(A(t))throw new Error(Object(l.q)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ji(t))throw new Error(Object(l.q)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ir=function(e,t,n,r){if(!(r&&void 0===n||Gi(n)))throw new Error(Object(l.q)(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},rr=function(e,t,n,r){if(!(r&&void 0===n||$i(n)))throw new Error(Object(l.q)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},sr=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),rr(e,t,n,r)},or=function(e,path){if(".info"===Se(path))throw new Error(e+" failed = Can't modify data under /.info/")},ar=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Gi(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),$i(e)}(n))throw new Error(Object(l.q)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class lr{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function cr(e,t){let n=null;for(let i=0;i<t.length;i++){const data=t[i],path=data.getPath();null===n||Ae(path,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:path}),n.events.push(data)}n&&e.eventLists_.push(n)}function ur(e,path,t){cr(e,t),_r(e,(e=>Ae(e,path)))}function dr(e,t,n){cr(e,n),_r(e,(e=>qe(e,t)||qe(t,e)))}function _r(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];if(r){t(r.path)?(pr(e.eventLists_[i]),e.eventLists_[i]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function pr(e){for(let i=0;i<e.events.length;i++){const t=e.events[i];if(null!==t){e.events[i]=null;const n=t.getEventRunner();k&&N("event: "+t.toString()),K(n)}}}const fr="repo_interrupt",gr=25;class mr{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new lr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ft(),this.transactionQueueTree_=new Fi,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function yr(e,t,n){if(e.stats_=ce(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new At(e.repoInfo_,((t,data,n,r)=>{Cr(e,t,data,n,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Tr(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(l.R)(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Be(e.repoInfo_,t,((t,data,n,r)=>{Cr(e,t,data,n,r)}),(t=>{Tr(e,t)}),(t=>{!function(e,t){H(t,((t,n)=>{Or(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return le[n]||(le[n]=t()),le[n]}(e.repoInfo_,(()=>new Bt(e.stats_,e.server_))),e.infoData_=new qt,e.infoSyncTree_=new ai({startListening:(t,n,r,o)=>{let l=[];const c=e.infoData_.getNode(t._path);return c.isEmpty()||(l=di(e.infoSyncTree_,t._path,c),setTimeout((()=>{o("ok")}),0)),l},stopListening:()=>{}}),Or(e,"connected",!1),e.serverSyncTree_=new ai({startListening:(t,n,r,o)=>(e.server_.listen(t,r,n,((n,data)=>{const r=o(n,data);dr(e.eventQueue_,t._path,r)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function vr(e){const t=e.infoData_.getNode(new Te(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function wr(e){return Ni({timestamp:vr(e)})}function Cr(e,t,data,n,r){e.dataUpdateCount++;const path=new Te(t);data=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,data):data;let o=[];if(r)if(n){const t=Object(l.L)(data,(e=>vt(e)));o=function(e,path,t,n){const r=Oi(e,n);if(r){const n=Si(r),o=n.path,l=n.queryId,c=Re(o,path),h=sn.fromObject(t);return Ii(e,o,new Kt(Ht(l),c,h))}return[]}(e.serverSyncTree_,path,t,r)}else{const t=vt(data);o=pi(e.serverSyncTree_,path,t,r)}else if(n){const t=Object(l.L)(data,(e=>vt(e)));o=function(e,path,t){const n=sn.fromObject(t);return yi(e,new Kt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,n))}(e.serverSyncTree_,path,t)}else{const t=vt(data);o=di(e.serverSyncTree_,path,t)}let c=path;o.length>0&&(c=Ar(e,path)),dr(e.eventQueue_,c,o)}function Tr(e,t){Or(e,"connected",t),!1===t&&function(e){xr(e,"onDisconnectEvents");const t=wr(e),n=Ft();Wt(e.onDisconnect_,Oe(),((path,r)=>{const o=Di(path,r,e.serverSyncTree_,t);Lt(n,path,o)}));let r=[];Wt(n,Oe(),((path,t)=>{r=r.concat(di(e.serverSyncTree_,path,t));const n=Wr(e,path);Ar(e,n)})),e.onDisconnect_=Ft(),dr(e.eventQueue_,Oe(),r)}(e)}function Or(e,t,n){const path=new Te("/.info/"+t),r=vt(n);e.infoData_.updateSnapshot(path,r);const o=di(e.infoSyncTree_,path,r);dr(e.eventQueue_,path,o)}function Sr(e){return e.nextWriteId_++}function Ir(e,path,t,n,r){xr(e,"set",{path:path.toString(),value:t,priority:n});const o=wr(e),l=vt(t,n),c=gi(e.serverSyncTree_,path),h=Ai(l,c,o),d=Sr(e),_=ci(e.serverSyncTree_,path,h,d,!0);cr(e.eventQueue_,_),e.server_.put(path.toString(),l.val(!0),((t,n)=>{const o="ok"===t;o||D("set at "+path+" failed: "+t);const l=ui(e.serverSyncTree_,d,!o);dr(e.eventQueue_,path,l),jr(e,r,t,n)}));const f=Wr(e,path);Ar(e,f),dr(e.eventQueue_,f,[])}function kr(e,path,t){e.server_.onDisconnectCancel(path.toString(),((n,r)=>{"ok"===n&&Mt(e.onDisconnect_,path),jr(e,t,n,r)}))}function Er(e,path,t,n){const r=vt(t);e.server_.onDisconnectPut(path.toString(),r.val(!0),((t,o)=>{"ok"===t&&Lt(e.onDisconnect_,path,r),jr(e,n,t,o)}))}function Pr(e,t,n){let r;r=".info"===Se(t._path)?_i(e.infoSyncTree_,t,n):_i(e.serverSyncTree_,t,n),ur(e.eventQueue_,t._path,r)}function Nr(e){e.persistentConnection_&&e.persistentConnection_.interrupt(fr)}function xr(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),N(n,...t)}function jr(e,t,n,r){t&&K((()=>{if("ok"===n)t(null);else{const code=(n||"error").toUpperCase();let e=code;r&&(e+=": "+r);const o=new Error(e);o.code=code,t(o)}}))}function Rr(e,path,t){return gi(e.serverSyncTree_,path,t)||gt.EMPTY_NODE}function Dr(e,t=e.transactionQueueTree_){if(t||Mr(e,t),Mi(t)){const n=Fr(e,t);Object(l.e)(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,path,t){const n=t.map((e=>e.currentWriteId)),r=Rr(e,path,n);let o=r;const c=r.hash();for(let i=0;i<t.length;i++){const e=t[i];Object(l.e)(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const n=Re(path,e.path);o=o.updateChild(n,e.currentOutputSnapshotRaw)}const h=o.val(!0),d=path;e.server_.put(d.toString(),h,(n=>{xr(e,"transaction put response",{path:d.toString(),status:n});let r=[];if("ok"===n){const n=[];for(let i=0;i<t.length;i++)t[i].status=2,r=r.concat(ui(e.serverSyncTree_,t[i].currentWriteId)),t[i].onComplete&&n.push((()=>t[i].onComplete(null,!0,t[i].currentOutputSnapshotResolved))),t[i].unwatcher();Mr(e,Li(e.transactionQueueTree_,path)),Dr(e,e.transactionQueueTree_),dr(e.eventQueue_,path,r);for(let i=0;i<n.length;i++)K(n[i])}else{if("datastale"===n)for(let i=0;i<t.length;i++)3===t[i].status?t[i].status=4:t[i].status=0;else{D("transaction at "+d.toString()+" failed: "+n);for(let i=0;i<t.length;i++)t[i].status=4,t[i].abortReason=n}Ar(e,path)}}),c)}(e,Hi(t),n)}else Ui(t)&&Bi(t,(t=>{Dr(e,t)}))}function Ar(e,t){const n=qr(e,t),path=Hi(n);return function(e,t,path){if(0===t.length)return;const n=[];let r=[];const o=t.filter((q=>0===q.status)),c=o.map((q=>q.currentWriteId));for(let i=0;i<t.length;i++){const o=t[i],d=Re(path,o.path);let _,f=!1;if(Object(l.e)(null!==d,"rerunTransactionsUnderNode_: relativePath should not be null."),4===o.status)f=!0,_=o.abortReason,r=r.concat(ui(e.serverSyncTree_,o.currentWriteId,!0));else if(0===o.status)if(o.retryCount>=gr)f=!0,_="maxretry",r=r.concat(ui(e.serverSyncTree_,o.currentWriteId,!0));else{const n=Rr(e,o.path,c);o.currentInputSnapshot=n;const h=t[i].update(n.val());if(void 0!==h){Zi("transaction failed: Data returned ",h,o.path);let t=vt(h);"object"==typeof h&&null!=h&&Object(l.k)(h,".priority")||(t=t.updatePriority(n.getPriority()));const d=o.currentWriteId,_=wr(e),f=Ai(t,n,_);o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=f,o.currentWriteId=Sr(e),c.splice(c.indexOf(d),1),r=r.concat(ci(e.serverSyncTree_,o.path,f,o.currentWriteId,o.applyLocally)),r=r.concat(ui(e.serverSyncTree_,d,!0))}else f=!0,_="nodata",r=r.concat(ui(e.serverSyncTree_,o.currentWriteId,!0))}dr(e.eventQueue_,path,r),r=[],f&&(t[i].status=2,h=t[i].unwatcher,setTimeout(h,Math.floor(0)),t[i].onComplete&&("nodata"===_?n.push((()=>t[i].onComplete(null,!1,t[i].currentInputSnapshot))):n.push((()=>t[i].onComplete(new Error(_),!1,null)))))}var h;Mr(e,e.transactionQueueTree_);for(let i=0;i<n.length;i++)K(n[i]);Dr(e,e.transactionQueueTree_)}(e,Fr(e,n),path),path}function qr(e,path){let t,n=e.transactionQueueTree_;for(t=Se(path);null!==t&&void 0===Mi(n);)n=Li(n,t),t=Se(path=ke(path));return n}function Fr(e,t){const n=[];return Lr(e,t,n),n.sort(((a,b)=>a.order-b.order)),n}function Lr(e,t,n){const r=Mi(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);Bi(t,(t=>{Lr(e,t,n)}))}function Mr(e,t){const n=Mi(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Wi(t,n.length>0?n:void 0)}Bi(t,(t=>{Mr(e,t)}))}function Wr(e,path){const t=Hi(qr(e,path)),n=Li(e.transactionQueueTree_,path);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(n,(t=>{Ur(e,t)})),Ur(e,n),Vi(n,(t=>{Ur(e,t)})),t}function Ur(e,t){const n=Mi(t);if(n){const r=[];let o=[],c=-1;for(let i=0;i<n.length;i++)3===n[i].status||(1===n[i].status?(Object(l.e)(c===i-1,"All SENT items should be at beginning of queue."),c=i,n[i].status=3,n[i].abortReason="set"):(Object(l.e)(0===n[i].status,"Unexpected transaction status in abort"),n[i].unwatcher(),o=o.concat(ui(e.serverSyncTree_,n[i].currentWriteId,!0)),n[i].onComplete&&r.push(n[i].onComplete.bind(null,new Error("set"),!1,null))));-1===c?Wi(t,void 0):n.length=c+1,dr(e.eventQueue_,Hi(t),o);for(let i=0;i<r.length;i++)K(r[i])}}const Br=function(e,t){const n=Vr(e),r=n.namespace;"firebase.com"===n.domain&&R(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||R("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&D("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const o="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new re(n.host,n.secure,r,o,t,"",r!==n.subdomain),path:new Te(n.pathString)}},Vr=function(e){let t="",n="",r="",o="",l="",c=!0,h="https",d=443;if("string"==typeof e){let _=e.indexOf("//");_>=0&&(h=e.substring(0,_-1),e=e.substring(_+2));let f=e.indexOf("/");-1===f&&(f=e.length);let m=e.indexOf("?");-1===m&&(m=e.length),t=e.substring(0,Math.min(f,m)),f<m&&(o=function(e){let t="";const n=e.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let e=n[i];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t}(e.substring(f,m)));const y=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):D(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,m)));_=t.indexOf(":"),_>=0?(c="https"===h||"wss"===h,d=parseInt(t.substring(_+1),10)):_=t.length;const v=t.slice(0,_);if("localhost"===v.toLowerCase())n="localhost";else if(v.split(".").length<=2)n=v;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),l=r}"ns"in y&&(l=y.ns)}return{host:t,port:d,domain:n,subdomain:r,secure:c,scheme:h,pathString:o,namespace:l}},Hr="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Qr=function(){let e=0;const t=[];return function(n){const r=n===e;let i;e=n;const o=new Array(8);for(i=7;i>=0;i--)o[i]=Hr.charAt(n%64),n=Math.floor(n/64);Object(l.e)(0===n,"Cannot push at time == 0");let c=o.join("");if(r){for(i=11;i>=0&&63===t[i];i--)t[i]=0;t[i]++}else for(i=0;i<12;i++)t[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)c+=Hr.charAt(t[i]);return Object(l.e)(20===c.length,"nextPushId: Length should be 20."),c}}();class zr{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Object(l.R)(this.snapshot.exportVal())}}class Yr{constructor(e,t,path){this.eventRegistration=e,this.error=t,this.path=path}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Kr{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Object(l.e)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Gr{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new l.a;return kr(this._repo,this._path,e.wrapCallback((()=>{}))),e.promise}remove(){or("OnDisconnect.remove",this._path);const e=new l.a;return Er(this._repo,this._path,null,e.wrapCallback((()=>{}))),e.promise}set(e){or("OnDisconnect.set",this._path),Xi("OnDisconnect.set",e,this._path,!1);const t=new l.a;return Er(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}setWithPriority(e,t){or("OnDisconnect.setWithPriority",this._path),Xi("OnDisconnect.setWithPriority",e,this._path,!1),nr("OnDisconnect.setWithPriority",t,!1);const n=new l.a;return function(e,path,t,n,r){const o=vt(t,n);e.server_.onDisconnectPut(path.toString(),o.val(!0),((t,n)=>{"ok"===t&&Lt(e.onDisconnect_,path,o),jr(0,r,t,n)}))}(this._repo,this._path,e,t,n.wrapCallback((()=>{}))),n.promise}update(e){or("OnDisconnect.update",this._path),er("OnDisconnect.update",e,this._path,!1);const t=new l.a;return function(e,path,t,n){if(Object(l.B)(t))return N("onDisconnect().update() called with empty data.  Don't do anything."),void jr(0,n,"ok",void 0);e.server_.onDisconnectMerge(path.toString(),t,((r,o)=>{"ok"===r&&H(t,((t,n)=>{const r=vt(n);Lt(e.onDisconnect_,xe(path,t),r)})),jr(0,n,r,o)}))}(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}}class $r{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return je(this._path)?null:Ee(this._path)}get ref(){return new es(this._repo,this._path)}get _queryIdentifier(){const e=Dt(this._queryParams),t=B(e);return"{}"===t?"default":t}get _queryObject(){return Dt(this._queryParams)}isEqual(e){if(!((e=Object(l.w)(e))instanceof $r))return!1;const t=this._repo===e._repo,n=Ae(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(path){let e="";for(let i=path.pieceNum_;i<path.pieces_.length;i++)""!==path.pieces_[i]&&(e+="/"+encodeURIComponent(String(path.pieces_[i])));return e||"/"}(this._path)}}function Jr(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Xr(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Ye){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==F)throw new Error(r);if("string"!=typeof t)throw new Error(o)}if(e.hasEnd()){if(e.getIndexEndName()!==L)throw new Error(r);if("string"!=typeof n)throw new Error(o)}}else if(e.getIndex()===at){if(null!=t&&!Ji(t)||null!=n&&!Ji(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(l.e)(e.getIndex()instanceof bt||e.getIndex()===wt,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Zr(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class es extends $r{constructor(e,path){super(e,path,new Pt,!1)}get parent(){const e=Ne(this._path);return null===e?null:new es(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ts{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(path){const e=new Te(path),t=rs(this.ref,path);return new ts(this._node.getChild(e),t,at)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new ts(n,rs(this.ref,t),at))))}hasChild(path){const e=new Te(path);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ns(e,path){return(e=Object(l.w)(e))._checkNotDeleted("ref"),void 0!==path?rs(e._root,path):e._root}function is(e,t){(e=Object(l.w)(e))._checkNotDeleted("refFromURL");const n=Br(t,e._repo.repoInfo_.nodeAdmin);ar("refFromURL",n);const r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||R("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),ns(e,n.path.toString())}function rs(e,path){return null===Se((e=Object(l.w)(e))._path)?sr("child","path",path,!1):rr("child","path",path,!1),new es(e._repo,xe(e._path,path))}function ss(e,t){e=Object(l.w)(e),or("push",e._path),Xi("push",t,e._path,!0);const n=vr(e._repo),r=Qr(n),o=rs(e,r),c=rs(e,r);let h;return h=null!=t?as(c,t).then((()=>c)):Promise.resolve(c),o.then=h.then.bind(h),o.catch=h.then.bind(h,void 0),o}function os(e){return or("remove",e._path),as(e,null)}function as(e,t){e=Object(l.w)(e),or("set",e._path),Xi("set",t,e._path,!1);const n=new l.a;return Ir(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}function ls(e,t){e=Object(l.w)(e),or("setPriority",e._path),nr("setPriority",t,!1);const n=new l.a;return Ir(e._repo,xe(e._path,".priority"),t,null,n.wrapCallback((()=>{}))),n.promise}function cs(e,t,n){if(or("setWithPriority",e._path),Xi("setWithPriority",t,e._path,!1),nr("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new l.a;return Ir(e._repo,e._path,t,n,r.wrapCallback((()=>{}))),r.promise}function hs(e,t){er("update",t,e._path,!1);const n=new l.a;return function(e,path,t,n){xr(e,"update",{path:path.toString(),value:t});let r=!0;const o=wr(e),l={};if(H(t,((t,n)=>{r=!1,l[t]=Di(xe(path,t),vt(n),e.serverSyncTree_,o)})),r)N("update() called with empty data.  Don't do anything."),jr(0,n,"ok",void 0);else{const r=Sr(e),o=hi(e.serverSyncTree_,path,l,r);cr(e.eventQueue_,o),e.server_.merge(path.toString(),t,((t,o)=>{const l="ok"===t;l||D("update at "+path+" failed: "+t);const c=ui(e.serverSyncTree_,r,!l),h=c.length>0?Ar(e,path):path;dr(e.eventQueue_,h,c),jr(0,n,t,o)})),H(t,(t=>{const n=Wr(e,xe(path,t));Ar(e,n)})),dr(e.eventQueue_,path,[])}}(e._repo,e._path,t,n.wrapCallback((()=>{}))),n.promise}function us(e){e=Object(l.w)(e);const t=new Kr((()=>{})),n=new ds(t);return function(e,t,n){const r=mi(e.serverSyncTree_,t);return null!=r?Promise.resolve(r):e.server_.get(t).then((r=>{const o=vt(r).withIndex(t._queryParams.getIndex());let l;if(fi(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())l=di(e.serverSyncTree_,t._path,o);else{const n=Ci(e.serverSyncTree_,t);l=pi(e.serverSyncTree_,t._path,o,n)}return dr(e.eventQueue_,t._path,l),_i(e.serverSyncTree_,t,n,null,!0),o}),(n=>(xr(e,"get for query "+Object(l.R)(t)+" failed: "+n),Promise.reject(new Error(n)))))}(e._repo,e,n).then((t=>new ts(t,new es(e._repo,e._path),e._queryParams.getIndex())))}class ds{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new zr("value",this,new ts(e.snapshotNode,new es(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,path){return this.callbackContext.hasCancelCallback?new Yr(this,e,path):null}matches(e){return e instanceof ds&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class _s{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,path){return this.callbackContext.hasCancelCallback?new Yr(this,e,path):null}createEvent(e,t){Object(l.e)(null!=e.childName,"Child events should have a childName.");const n=rs(new es(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new zr(e.type,this,new ts(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof _s&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function ps(e,t,n,r,o){let l;if("object"==typeof r&&(l=void 0,o=r),"function"==typeof r&&(l=r),o&&o.onlyOnce){const t=n,r=(n,r)=>{Pr(e._repo,e,h),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}const c=new Kr(n,l||void 0),h="value"===t?new ds(c):new _s(t,c);return function(e,t,n){let r;r=".info"===Se(t._path)?fi(e.infoSyncTree_,t,n):fi(e.serverSyncTree_,t,n),ur(e.eventQueue_,t._path,r)}(e._repo,e,h),()=>Pr(e._repo,e,h)}function fs(e,t,n,r){return ps(e,"value",t,n,r)}function gs(e,t,n,r){return ps(e,"child_added",t,n,r)}function ms(e,t,n,r){return ps(e,"child_changed",t,n,r)}function ys(e,t,n,r){return ps(e,"child_moved",t,n,r)}function vs(e,t,n,r){return ps(e,"child_removed",t,n,r)}function bs(e,t,n){let r=null;const o=n?new Kr(n):null;"value"===t?r=new ds(o):t&&(r=new _s(t,o)),Pr(e._repo,e,r)}class ws{}class Cs extends ws{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xi("endAt",this._value,e._path,!0);const t=xt(e._queryParams,this._value,this._key);if(Zr(t),Xr(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new $r(e._repo,e._path,t,e._orderByCalled)}}function Ts(e,t){return ir("endAt","key",t,!0),new Cs(e,t)}class Os extends ws{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xi("endBefore",this._value,e._path,!1);const t=function(e,t,n){let r;return r=e.index_===Ye||n?xt(e,t,n):xt(e,t,F),r.endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(Zr(t),Xr(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new $r(e._repo,e._path,t,e._orderByCalled)}}function Ss(e,t){return ir("endBefore","key",t,!0),new Os(e,t)}class Is extends ws{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xi("startAt",this._value,e._path,!0);const t=Nt(e._queryParams,this._value,this._key);if(Zr(t),Xr(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new $r(e._repo,e._path,t,e._orderByCalled)}}function ks(e=null,t){return ir("startAt","key",t,!0),new Is(e,t)}class Es extends ws{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xi("startAfter",this._value,e._path,!1);const t=function(e,t,n){let r;return r=e.index_===Ye||n?Nt(e,t,n):Nt(e,t,L),r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(Zr(t),Xr(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new $r(e._repo,e._path,t,e._orderByCalled)}}function Ps(e,t){return ir("startAfter","key",t,!0),new Es(e,t)}class Ns extends ws{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new $r(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}function xs(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Ns(e)}class js extends ws{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new $r(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}function Rs(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new js(e)}class Ds extends ws{constructor(e){super(),this._path=e}_apply(e){Jr(e,"orderByChild");const t=new Te(this._path);if(je(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const n=new bt(t),r=jt(e._queryParams,n);return Xr(r),new $r(e._repo,e._path,r,!0)}}function As(path){if("$key"===path)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===path)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===path)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return rr("orderByChild","path",path,!1),new Ds(path)}class qs extends ws{_apply(e){Jr(e,"orderByKey");const t=jt(e._queryParams,Ye);return Xr(t),new $r(e._repo,e._path,t,!0)}}function Fs(){return new qs}class Ls extends ws{_apply(e){Jr(e,"orderByPriority");const t=jt(e._queryParams,at);return Xr(t),new $r(e._repo,e._path,t,!0)}}function Ms(){return new Ls}class Ws extends ws{_apply(e){Jr(e,"orderByValue");const t=jt(e._queryParams,wt);return Xr(t),new $r(e._repo,e._path,t,!0)}}function Us(){return new Ws}class Bs extends ws{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Xi("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Cs(this._value,this._key)._apply(new Is(this._value,this._key)._apply(e))}}function Vs(e,t){return ir("equalTo","key",t,!0),new Bs(e,t)}function Hs(e,...t){let n=Object(l.w)(e);for(const e of t)n=e._apply(n);return n}!function(e){Object(l.e)(!Yn,"__referenceConstructor has already been defined"),Yn=e}(es),function(e){Object(l.e)(!Kn,"__referenceConstructor has already been defined"),Kn=e}(es);const Qs="FIREBASE_DATABASE_EMULATOR_HOST",zs={};let Ys=!1;function Ks(t,n,r,o,l){let c=o||t.options.databaseURL;void 0===c&&(t.options.projectId||R("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),N("Using default host for project ",t.options.projectId),c=`${t.options.projectId}-default-rtdb.firebaseio.com`);let h,d,_=Br(c,l),f=_.repoInfo;void 0!==e&&e.env&&(d=e.env[Qs]),d?(h=!0,c=`http://${d}?ns=${f.namespace}`,_=Br(c,l),f=_.repoInfo):h=!_.repoInfo.secure;const m=l&&h?new X(X.OWNER):new J(t.name,t.options,n);ar("Invalid Firebase Database URL",_),je(_.path)||R("Database URL must point to the root of a Firebase Database (not including a child path).");const y=function(e,t,n,r){let o=zs[t.name];o||(o={},zs[t.name]=o);let l=o[e.toURLString()];l&&R("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return l=new mr(e,Ys,n,r),o[e.toURLString()]=l,l}(f,t,m,new $(t.name,r));return new Gs(y,t)}class Gs{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(yr(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new es(this._repo,Oe())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=zs[t];n&&n[e.key]===e||R(`Database ${t}(${e.repoInfo_}) has already been deleted.`),Nr(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&R("Cannot call "+e+" on a deleted database.")}}function $s(){ge.IS_TRANSPORT_INITIALIZED&&D("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Js(){$s(),de.forceDisallow()}function Xs(){$s(),fe.forceDisallow(),de.forceAllow()}function Zs(e,t,n,r={}){(e=Object(l.w)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&R("Cannot call useEmulator() after instance has already been initialized.");const o=e._repoInternal;let c;if(o.repoInfo_.nodeAdmin)r.mockUserToken&&R('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),c=new X(X.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:Object(l.l)(r.mockUserToken,e.app.options.projectId);c=new X(t)}!function(e,t,n,r){e.repoInfo_=new re(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),r&&(e.authTokenProvider_=r)}(o,t,n,c)}function eo(e){(e=Object(l.w)(e))._checkNotDeleted("goOffline"),Nr(e._repo)}function to(e){var t;(e=Object(l.w)(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume(fr)}function no(e,t){P(e,t)}const io={".sv":"timestamp"};function ro(){return io}function so(e){return{".sv":{increment:e}}}class oo{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function ao(e,t,n){var r;if(e=Object(l.w)(e),or("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";const o=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,c=new l.a,h=fs(e,(()=>{}));return function(e,path,t,n,r,o){xr(e,"transaction on "+path);const c={path:path,update:t,onComplete:n,status:null,order:O(),applyLocally:o,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=Rr(e,path,void 0);c.currentInputSnapshot=h;const d=c.update(h.val());if(void 0===d)c.unwatcher(),c.currentOutputSnapshotRaw=null,c.currentOutputSnapshotResolved=null,c.onComplete&&c.onComplete(null,!1,c.currentInputSnapshot);else{Zi("transaction failed: Data returned ",d,c.path),c.status=0;const t=Li(e.transactionQueueTree_,path),n=Mi(t)||[];let r;n.push(c),Wi(t,n),"object"==typeof d&&null!==d&&Object(l.k)(d,".priority")?(r=Object(l.O)(d,".priority"),Object(l.e)(Ji(r),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):r=(gi(e.serverSyncTree_,path)||gt.EMPTY_NODE).getPriority().val();const o=wr(e),_=vt(d,r),f=Ai(_,h,o);c.currentOutputSnapshotRaw=_,c.currentOutputSnapshotResolved=f,c.currentWriteId=Sr(e);const m=ci(e.serverSyncTree_,path,f,c.currentWriteId,c.applyLocally);dr(e.eventQueue_,path,m),Dr(e,e.transactionQueueTree_)}}(e._repo,e._path,t,((t,n,r)=>{let o=null;t?c.reject(t):(o=new ts(r,new es(e._repo,e._path),at),c.resolve(new oo(n,o)))}),h,o),c.promise}Be.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Be.prototype.echo=function(data,e){this.sendRequest("echo",{d:data},e)};var lo;f(r.SDK_VERSION),Object(r._registerComponent)(new o.a("database",((e,{instanceIdentifier:t})=>Ks(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),Object(r.registerVersion)(h,d,lo),Object(r.registerVersion)(h,d,"esm2017")}).call(this,n(421))},858:function(e,t,n){"use strict";n.r(t);var r=n(815),o=n(812),l=n(840),c=n(811),h=n(814);const d=new h.b("@firebase/database-compat"),_=function(e){const t="FIREBASE WARNING: "+e;d.warn(t)};class f{constructor(e){this._delegate=e}cancel(e){Object(c.S)("OnDisconnect.cancel",0,1,arguments.length),Object(c.T)("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then((()=>e(null)),(t=>e(t))),t}remove(e){Object(c.S)("OnDisconnect.remove",0,1,arguments.length),Object(c.T)("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then((()=>e(null)),(t=>e(t))),t}set(e,t){Object(c.S)("OnDisconnect.set",1,2,arguments.length),Object(c.T)("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then((()=>t(null)),(e=>t(e))),n}setWithPriority(e,t,n){Object(c.S)("OnDisconnect.setWithPriority",2,3,arguments.length),Object(c.T)("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then((()=>n(null)),(e=>n(e))),r}update(e,t){if(Object(c.S)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let i=0;i<e.length;++i)t[""+i]=e[i];e=t,_("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(c.T)("OnDisconnect.update","onComplete",t,!0);const n=this._delegate.update(e);return t&&n.then((()=>t(null)),(e=>t(e))),n}}class m{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Object(c.S)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class y{constructor(e,t){this._database=e,this._delegate=t}val(){return Object(c.S)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Object(c.S)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Object(c.S)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Object(c.S)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(path){return Object(c.S)("DataSnapshot.child",0,1,arguments.length),path=String(path),Object(l.g)("DataSnapshot.child","path",path,!1),new y(this._database,this._delegate.child(path))}hasChild(path){return Object(c.S)("DataSnapshot.hasChild",1,1,arguments.length),Object(l.g)("DataSnapshot.hasChild","path",path,!1),this._delegate.hasChild(path)}getPriority(){return Object(c.S)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return Object(c.S)("DataSnapshot.forEach",1,1,arguments.length),Object(c.T)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach((t=>e(new y(this._database,t))))}hasChildren(){return Object(c.S)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Object(c.S)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Object(c.S)("DataSnapshot.ref",0,0,arguments.length),new w(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class v{constructor(e,t){this.database=e,this._delegate=t}on(e,t,n,r){var o;Object(c.S)("Query.on",2,4,arguments.length),Object(c.T)("Query.on","callback",t,!1);const h=v.getCancelAndContextArgs_("Query.on",n,r),d=(e,n)=>{t.call(h.context,new y(this.database,e),n)};d.userCallback=t,d.context=h.context;const _=null===(o=h.cancel)||void 0===o?void 0:o.bind(h.context);switch(e){case"value":return Object(l.B)(this._delegate,d,_),t;case"child_added":return Object(l.x)(this._delegate,d,_),t;case"child_removed":return Object(l.A)(this._delegate,d,_),t;case"child_changed":return Object(l.y)(this._delegate,d,_),t;case"child_moved":return Object(l.z)(this._delegate,d,_),t;default:throw new Error(Object(c.q)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){if(Object(c.S)("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(c.q)(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),Object(c.T)("Query.off","callback",t,!0),Object(c.U)("Query.off","context",n,!0),t){const r=()=>{};r.userCallback=t,r.context=n,Object(l.w)(this._delegate,e,r)}else Object(l.w)(this._delegate,e)}get(){return Object(l.q)(this._delegate).then((e=>new y(this.database,e)))}once(e,t,n,r){Object(c.S)("Query.once",1,4,arguments.length),Object(c.T)("Query.once","callback",t,!0);const o=v.getCancelAndContextArgs_("Query.once",n,r),h=new c.a,d=(e,n)=>{const r=new y(this.database,e);t&&t.call(o.context,r,n),h.resolve(r)};d.userCallback=t,d.context=o.context;const _=e=>{o.cancel&&o.cancel.call(o.context,e),h.reject(e)};switch(e){case"value":Object(l.B)(this._delegate,d,_,{onlyOnce:!0});break;case"child_added":Object(l.x)(this._delegate,d,_,{onlyOnce:!0});break;case"child_removed":Object(l.A)(this._delegate,d,_,{onlyOnce:!0});break;case"child_changed":Object(l.y)(this._delegate,d,_,{onlyOnce:!0});break;case"child_moved":Object(l.z)(this._delegate,d,_,{onlyOnce:!0});break;default:throw new Error(Object(c.q)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return h.promise}limitToFirst(e){return Object(c.S)("Query.limitToFirst",1,1,arguments.length),new v(this.database,Object(l.H)(this._delegate,Object(l.u)(e)))}limitToLast(e){return Object(c.S)("Query.limitToLast",1,1,arguments.length),new v(this.database,Object(l.H)(this._delegate,Object(l.v)(e)))}orderByChild(path){return Object(c.S)("Query.orderByChild",1,1,arguments.length),new v(this.database,Object(l.H)(this._delegate,Object(l.C)(path)))}orderByKey(){return Object(c.S)("Query.orderByKey",0,0,arguments.length),new v(this.database,Object(l.H)(this._delegate,Object(l.D)()))}orderByPriority(){return Object(c.S)("Query.orderByPriority",0,0,arguments.length),new v(this.database,Object(l.H)(this._delegate,Object(l.E)()))}orderByValue(){return Object(c.S)("Query.orderByValue",0,0,arguments.length),new v(this.database,Object(l.H)(this._delegate,Object(l.F)()))}startAt(e=null,t){return Object(c.S)("Query.startAt",0,2,arguments.length),new v(this.database,Object(l.H)(this._delegate,Object(l.R)(e,t)))}startAfter(e=null,t){return Object(c.S)("Query.startAfter",0,2,arguments.length),new v(this.database,Object(l.H)(this._delegate,Object(l.Q)(e,t)))}endAt(e=null,t){return Object(c.S)("Query.endAt",0,2,arguments.length),new v(this.database,Object(l.H)(this._delegate,Object(l.l)(e,t)))}endBefore(e=null,t){return Object(c.S)("Query.endBefore",0,2,arguments.length),new v(this.database,Object(l.H)(this._delegate,Object(l.m)(e,t)))}equalTo(e,t){return Object(c.S)("Query.equalTo",1,2,arguments.length),new v(this.database,Object(l.H)(this._delegate,Object(l.n)(e,t)))}toString(){return Object(c.S)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Object(c.S)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Object(c.S)("Query.isEqual",1,1,arguments.length),!(e instanceof v)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Object(c.T)(e,"cancel",r.cancel,!0),r.context=n,Object(c.U)(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Object(c.q)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new w(this.database,new l.d(this._delegate._repo,this._delegate._path))}}class w extends v{constructor(e,t){super(e,new l.b(t._repo,t._path,new l.c,!1)),this.database=e,this._delegate=t}getKey(){return Object(c.S)("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Object(c.S)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new w(this.database,Object(l.i)(this._delegate,e))}getParent(){Object(c.S)("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new w(this.database,e):null}getRoot(){return Object(c.S)("Reference.root",0,0,arguments.length),new w(this.database,this._delegate.root)}set(e,t){Object(c.S)("Reference.set",1,2,arguments.length),Object(c.T)("Reference.set","onComplete",t,!0);const n=Object(l.N)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}update(e,t){if(Object(c.S)("Reference.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let i=0;i<e.length;++i)t[""+i]=e[i];e=t,_("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(l.h)("Reference.update",this._delegate._path),Object(c.T)("Reference.update","onComplete",t,!0);const n=Object(l.S)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}setWithPriority(e,t,n){Object(c.S)("Reference.setWithPriority",2,3,arguments.length),Object(c.T)("Reference.setWithPriority","onComplete",n,!0);const r=Object(l.P)(this._delegate,e,t);return n&&r.then((()=>n(null)),(e=>n(e))),r}remove(e){Object(c.S)("Reference.remove",0,1,arguments.length),Object(c.T)("Reference.remove","onComplete",e,!0);const t=Object(l.K)(this._delegate);return e&&t.then((()=>e(null)),(t=>e(t))),t}transaction(e,t,n){Object(c.S)("Reference.transaction",1,3,arguments.length),Object(c.T)("Reference.transaction","transactionUpdate",e,!1),Object(c.T)("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(c.q)(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=Object(l.L)(this._delegate,e,{applyLocally:n}).then((e=>new m(e.committed,new y(this.database,e.snapshot))));return t&&r.then((e=>t(null,e.committed,e.snapshot)),(e=>t(e,!1,null))),r}setPriority(e,t){Object(c.S)("Reference.setPriority",1,2,arguments.length),Object(c.T)("Reference.setPriority","onComplete",t,!0);const n=Object(l.O)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}push(e,t){Object(c.S)("Reference.push",0,2,arguments.length),Object(c.T)("Reference.push","onComplete",t,!0);const n=Object(l.G)(this._delegate,e),r=n.then((e=>new w(this.database,e)));t&&r.then((()=>t(null)),(e=>t(e)));const o=new w(this.database,n);return o.then=r.then.bind(r),o.catch=r.catch.bind(r,void 0),o}onDisconnect(){return Object(l.h)("Reference.onDisconnect",this._delegate._path),new f(new l.a(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class C{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:l.p,forceLongPolling:l.o}}useEmulator(e,t,n={}){Object(l.j)(this._delegate,e,t,n)}ref(path){if(Object(c.S)("database.ref",0,1,arguments.length),path instanceof w){const e=Object(l.J)(this._delegate,path.toString());return new w(this,e)}{const e=Object(l.I)(this._delegate,path);return new w(this,e)}}refFromURL(e){Object(c.S)("database.refFromURL",1,1,arguments.length);const t=Object(l.J)(this._delegate,e);return new w(this,t)}goOffline(){return Object(c.S)("database.goOffline",0,0,arguments.length),Object(l.r)(this._delegate)}goOnline(){return Object(c.S)("database.goOnline",0,0,arguments.length),Object(l.s)(this._delegate)}}C.ServerValue={TIMESTAMP:Object(l.M)(),increment:e=>Object(l.t)(e)};var T=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:c,nodeAdmin:h=!1}){Object(l.f)(n);const d=new o.c("auth-internal",new o.b("database-standalone"));return d.setComponent(new o.a("auth-internal",(()=>r),"PRIVATE")),{instance:new C(Object(l.e)(e,d,void 0,t,h),e),namespace:c}}});const O=C.ServerValue;var S;(S=r.a).INTERNAL.registerComponent(new o.a("database-compat",((e,{instanceIdentifier:t})=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new C(r,n)}),"PUBLIC").setServiceProps({Reference:w,Query:v,Database:C,DataSnapshot:y,enableLogging:l.k,INTERNAL:T,ServerValue:O}).setMultipleInstances(!0)),S.registerVersion("@firebase/database-compat","0.3.4")}}]);